<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">

<title>module SafeInPlaceEditingHelper - YOUR_TITLE</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body id="top" class="module">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>lib/safe_in_place_editing/safe_in_place_editing_helper.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    
    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-i-safe_in_place_editor">#safe_in_place_editor</a>
    
    <li><a href="#method-i-safe_in_place_editor_field">#safe_in_place_editor_field</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="./doc/README_FOR_APP.html">README_FOR_APP</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./TrackRecordReport.html">TrackRecordReport</a>
  
    <li><a href="./TrackRecordReport/Calculator.html">TrackRecordReport::Calculator</a>
  
    <li><a href="./TrackRecordReport/CalculatorWithUsers.html">TrackRecordReport::CalculatorWithUsers</a>
  
    <li><a href="./TrackRecordReport/Cell.html">TrackRecordReport::Cell</a>
  
    <li><a href="./TrackRecordReport/Report.html">TrackRecordReport::Report</a>
  
    <li><a href="./TrackRecordReport/Row.html">TrackRecordReport::Row</a>
  
    <li><a href="./TrackRecordReport/Section.html">TrackRecordReport::Section</a>
  
    <li><a href="./TrackRecordSections.html">TrackRecordSections</a>
  
    <li><a href="./TrackRecordSections/Group.html">TrackRecordSections::Group</a>
  
    <li><a href="./TrackRecordSections/GroupMixin.html">TrackRecordSections::GroupMixin</a>
  
    <li><a href="./TrackRecordSections/Section.html">TrackRecordSections::Section</a>
  
    <li><a href="./TrackRecordSections/SectionMixin.html">TrackRecordSections::SectionMixin</a>
  
    <li><a href="./TrackRecordSections/Sections.html">TrackRecordSections::Sections</a>
  
    <li><a href="./TrackRecordSections/SectionsMixin.html">TrackRecordSections::SectionsMixin</a>
  
    <li><a href="./ReportsHelper.html">ReportsHelper</a>
  
    <li><a href="./ReportsHelper/ReportMonth.html">ReportsHelper::ReportMonth</a>
  
    <li><a href="./ReportsHelper/ReportWeek.html">ReportsHelper::ReportWeek</a>
  
    <li><a href="./ReportsHelper/ReportYear.html">ReportsHelper::ReportYear</a>
  
    <li><a href="./QuietLeightbox.html">QuietLeightbox</a>
  
    <li><a href="./QuietLeightbox/ClassMethods.html">QuietLeightbox::ClassMethods</a>
  
    <li><a href="./QuietLeightbox/QuietLeightboxHelper.html">QuietLeightbox::QuietLeightboxHelper</a>
  
    <li><a href="./QuietPrototype.html">QuietPrototype</a>
  
    <li><a href="./QuietPrototype/ClassMethods.html">QuietPrototype::ClassMethods</a>
  
    <li><a href="./QuietPrototype/QuietPrototypeHelper.html">QuietPrototype::QuietPrototypeHelper</a>
  
    <li><a href="./YuiTree.html">YuiTree</a>
  
    <li><a href="./YuiTree/ClassMethods.html">YuiTree::ClassMethods</a>
  
    <li><a href="./YuiTree/YuiTreeHelper.html">YuiTree::YuiTreeHelper</a>
  
    <li><a href="./SafeInPlaceEditing.html">SafeInPlaceEditing</a>
  
    <li><a href="./SafeInPlaceEditing/ClassMethods.html">SafeInPlaceEditing::ClassMethods</a>
  
    <li><a href="./TrackRecordReportGenerator.html">TrackRecordReportGenerator</a>
  
    <li><a href="./TrackRecordReportGenerator/UkOrgPondCSV.html">TrackRecordReportGenerator::UkOrgPondCSV</a>
  
    <li><a href="./ApplicationController.html">ApplicationController</a>
  
    <li><a href="./ApplicationHelper.html">ApplicationHelper</a>
  
    <li><a href="./AuditsController.html">AuditsController</a>
  
    <li><a href="./AuditsHelper.html">AuditsHelper</a>
  
    <li><a href="./ChartsController.html">ChartsController</a>
  
    <li><a href="./ChartsHelper.html">ChartsHelper</a>
  
    <li><a href="./ControlPanel.html">ControlPanel</a>
  
    <li><a href="./ControlPanelsController.html">ControlPanelsController</a>
  
    <li><a href="./Customer.html">Customer</a>
  
    <li><a href="./CustomersController.html">CustomersController</a>
  
    <li><a href="./CustomersHelper.html">CustomersHelper</a>
  
    <li><a href="./EmailNotifier.html">EmailNotifier</a>
  
    <li><a href="./HelpController.html">HelpController</a>
  
    <li><a href="./HelpHelper.html">HelpHelper</a>
  
    <li><a href="./Project.html">Project</a>
  
    <li><a href="./ProjectsController.html">ProjectsController</a>
  
    <li><a href="./ProjectsHelper.html">ProjectsHelper</a>
  
    <li><a href="./Rangeable.html">Rangeable</a>
  
    <li><a href="./ReportsController.html">ReportsController</a>
  
    <li><a href="./SafeInPlaceEditingHelper.html">SafeInPlaceEditingHelper</a>
  
    <li><a href="./SavedReport.html">SavedReport</a>
  
    <li><a href="./SavedReportAutoTitlesController.html">SavedReportAutoTitlesController</a>
  
    <li><a href="./SavedReportsBaseController.html">SavedReportsBaseController</a>
  
    <li><a href="./SavedReportsByCustomerController.html">SavedReportsByCustomerController</a>
  
    <li><a href="./SavedReportsByProjectController.html">SavedReportsByProjectController</a>
  
    <li><a href="./SavedReportsByTaskController.html">SavedReportsByTaskController</a>
  
    <li><a href="./SavedReportsByUserController.html">SavedReportsByUserController</a>
  
    <li><a href="./SavedReportsController.html">SavedReportsController</a>
  
    <li><a href="./SavedReportsHelper.html">SavedReportsHelper</a>
  
    <li><a href="./SessionsController.html">SessionsController</a>
  
    <li><a href="./Task.html">Task</a>
  
    <li><a href="./TaskGroup.html">TaskGroup</a>
  
    <li><a href="./TaskImport.html">TaskImport</a>
  
    <li><a href="./TaskImportsController.html">TaskImportsController</a>
  
    <li><a href="./TaskImportsHelper.html">TaskImportsHelper</a>
  
    <li><a href="./TasksController.html">TasksController</a>
  
    <li><a href="./TasksHelper.html">TasksHelper</a>
  
    <li><a href="./Timesheet.html">Timesheet</a>
  
    <li><a href="./TimesheetForceCommit.html">TimesheetForceCommit</a>
  
    <li><a href="./TimesheetForceCommitsController.html">TimesheetForceCommitsController</a>
  
    <li><a href="./TimesheetRow.html">TimesheetRow</a>
  
    <li><a href="./TimesheetRowsController.html">TimesheetRowsController</a>
  
    <li><a href="./TimesheetRowsHelper.html">TimesheetRowsHelper</a>
  
    <li><a href="./TimesheetsController.html">TimesheetsController</a>
  
    <li><a href="./TimesheetsHelper.html">TimesheetsHelper</a>
  
    <li><a href="./TreesController.html">TreesController</a>
  
    <li><a href="./User.html">User</a>
  
    <li><a href="./UsersController.html">UsersController</a>
  
    <li><a href="./UsersHelper.html">UsersHelper</a>
  
    <li><a href="./WorkPacket.html">WorkPacket</a>
  
    <li><a href="./WorkPacketsController.html">WorkPacketsController</a>
  
    <li><a href="./WorkPacketsHelper.html">WorkPacketsHelper</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="module">module SafeInPlaceEditingHelper</h1>

  <div id="description" class="description">
    <dl class="rdoc-list note-list"><dt>File
<dd>
<p>safe_in_place_editing_helper.rb</p>
</dd><dt>(C)
<dd>
<p>Hipposoft 2008</p>
</dd><dt>Purpose
<dd>
<p>Safe, lockable in-place editing - helper methods.</p>
</dd></dl>
<hr style="height: 10px">

<pre>24-Jun-2008 (ADH): Created.</pre>

  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    <!-- Methods -->
    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-safe_in_place_editor" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">safe_in_place_editor</span><span
            class="method-args">( field_id, options = {} )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Exact API equivalent of in_place_editor, except fixes various bugs (see
README for the rationale) and:</p>
<ul><li>
<p>New option “:lock_var”, which is the name of a global variable to be used
in the JS domain to track the lock version at the client side. By default
set to nil, meaning no optimistic locking support. Options value
“:lock_version” MUST be set to the lock version of the object for which the
in-place editor is being created in this case. The variable is incremented
each time the object is successfully updated through the in-place editor,
since the server will have incremented its lock version so the client must
keep in step. If someone else edits the item, the client and server lock
versions will not match and the update will fail, which is the desired
result.</p>
</li><li>
<p>The “:save_text” option is set to “OK” by default, since I detest that
nasty lower case “ok” button that’s produced by the JS code otherwise.</p>
</li><li>
<p>The “:cancel_text” option is set to “Cancel” by default to match the above
change.</p>
</li><li>
<p>New option “:is_boolean” indicating a true/false popup should be offered
instead of a text field; if omitted, a text field is assumed. If present
and ‘true’, additional optional value “:first_value” says whether or not
the pop-up menu should start with True/Yes (if “:first_value”‘s value is
itself true), or False/No (if “:first_value”’s value is itself false, or if
the option is omitted).</p>
</li></ul>

<p>Custom on-failure and on-complete functions are used. To try and reduce the
code bulk for each instance of the editor, hard-coded JS function names are
used with the support code placed in ‘safe_in_place_editing.js’. See there
for a reference implementation if intending to write customised
equivalents. To override the default names of these functions for any
reason, give the names as strings in options properties :on_complete and
:on_failure, then make sure appropriate JS functions are actually defined.</p>
          

          
          <div class="method-source-code" id="safe_in_place_editor-source">
            <pre><span class="ruby-comment"># File lib/safe_in_place_editing/safe_in_place_editing_helper.rb, line 47</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">safe_in_place_editor</span>( <span class="ruby-identifier">field_id</span>, <span class="ruby-identifier">options</span> = {} )

  <span class="ruby-comment"># Set up some default values</span>

  <span class="ruby-identifier">options</span>[ <span class="ruby-value">:with</span> ] <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;Form.serialize(form).replace(/\\+/g,'%20')&quot;</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">protect_against_forgery?</span>
    <span class="ruby-identifier">options</span>[ <span class="ruby-value">:with</span> ] <span class="ruby-operator">+=</span> <span class="ruby-node">&quot; + '&amp;authenticity_token=' + encodeURIComponent('#{ form_authenticity_token }')&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">options</span>[ <span class="ruby-value">:on_complete</span> ] <span class="ruby-operator">||=</span> <span class="ruby-string">'safeInPlaceEditorOnComplete'</span>
  <span class="ruby-identifier">options</span>[ <span class="ruby-value">:on_failure</span>  ] <span class="ruby-operator">||=</span> <span class="ruby-string">'safeInPlaceEditorOnFailure'</span>
  <span class="ruby-identifier">options</span>[ <span class="ruby-value">:save_text</span>   ] <span class="ruby-operator">||=</span> <span class="ruby-string">'OK'</span>
  <span class="ruby-identifier">options</span>[ <span class="ruby-value">:cancel_text</span> ] <span class="ruby-operator">||=</span> <span class="ruby-string">'Cancel'</span>

  <span class="ruby-comment"># Preliminary script data</span>

  <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">options</span>.<span class="ruby-identifier">include?</span>( <span class="ruby-value">:lock_var</span> ) )
    <span class="ruby-identifier">function</span> = <span class="ruby-node">&quot;window['#{ options[ :lock_var ] }']=#{ options[ :lock_version ] };&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">function</span> = <span class="ruby-string">''</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">function_name</span> = <span class="ruby-identifier">options</span>[ <span class="ruby-value">:is_boolean</span> ] <span class="ruby-operator">?</span> <span class="ruby-string">'InPlaceCollectionEditor'</span> <span class="ruby-operator">:</span> <span class="ruby-string">'InPlaceEditor'</span>

  <span class="ruby-identifier">function</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;new Ajax.#{ function_name }(&quot;</span>
  <span class="ruby-identifier">function</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;'#{ field_id }', &quot;</span>
  <span class="ruby-identifier">function</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;'#{ url_for( options[ :url ] ) }'&quot;</span>

  <span class="ruby-comment"># Map Rails in-place editor options to JS in-place editor options - see:</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment">#   http://github.com/madrobby/scriptaculous/wikis/ajax-inplaceeditor</span>

  <span class="ruby-identifier">js_options</span> = {}

  <span class="ruby-identifier">js_options</span>[ <span class="ruby-string">'rows'</span>                ] =   <span class="ruby-identifier">options</span>[ <span class="ruby-value">:rows</span>    ] <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[ <span class="ruby-value">:rows</span>    ]
  <span class="ruby-identifier">js_options</span>[ <span class="ruby-string">'cols'</span>                ] =   <span class="ruby-identifier">options</span>[ <span class="ruby-value">:cols</span>    ] <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[ <span class="ruby-value">:cols</span>    ]
  <span class="ruby-identifier">js_options</span>[ <span class="ruby-string">'size'</span>                ] =   <span class="ruby-identifier">options</span>[ <span class="ruby-value">:size</span>    ] <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[ <span class="ruby-value">:size</span>    ]
  <span class="ruby-identifier">js_options</span>[ <span class="ruby-string">'ajaxOptions'</span>         ] =   <span class="ruby-identifier">options</span>[ <span class="ruby-value">:options</span> ] <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[ <span class="ruby-value">:options</span> ]
  <span class="ruby-identifier">js_options</span>[ <span class="ruby-string">'htmlResponse'</span>        ] = <span class="ruby-operator">!</span> <span class="ruby-identifier">options</span>[ <span class="ruby-value">:script</span>  ] <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[ <span class="ruby-value">:script</span>  ]

  <span class="ruby-identifier">js_options</span>[ <span class="ruby-string">'cancelText'</span>          ] = <span class="ruby-node">%Q('#{ options[ :cancel_text           ] }')</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[ <span class="ruby-value">:cancel_text</span>           ]
  <span class="ruby-identifier">js_options</span>[ <span class="ruby-string">'okText'</span>              ] = <span class="ruby-node">%Q('#{ options[ :save_text             ] }')</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[ <span class="ruby-value">:save_text</span>             ]
  <span class="ruby-identifier">js_options</span>[ <span class="ruby-string">'loadingText'</span>         ] = <span class="ruby-node">%Q('#{ options[ :loading_text          ] }')</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[ <span class="ruby-value">:loading_text</span>          ]
  <span class="ruby-identifier">js_options</span>[ <span class="ruby-string">'savingText'</span>          ] = <span class="ruby-node">%Q('#{ options[ :saving_text           ] }')</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[ <span class="ruby-value">:saving_text</span>           ]
  <span class="ruby-identifier">js_options</span>[ <span class="ruby-string">'clickToEditText'</span>     ] = <span class="ruby-node">%Q('#{ options[ :click_to_edit_text    ] }')</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[ <span class="ruby-value">:click_to_edit_text</span>    ]
  <span class="ruby-identifier">js_options</span>[ <span class="ruby-string">'textBetweenControls'</span> ] = <span class="ruby-node">%Q('#{ options[ :text_between_controls ] }')</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[ <span class="ruby-value">:text_between_controls</span> ]

  <span class="ruby-identifier">js_options</span>[ <span class="ruby-string">'externalControl'</span>     ] = <span class="ruby-node">&quot;'#{          options[ :external_control ]   }'&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[ <span class="ruby-value">:external_control</span> ]
  <span class="ruby-identifier">js_options</span>[ <span class="ruby-string">'loadTextURL'</span>         ] = <span class="ruby-node">&quot;'#{ url_for( options[ :load_text_url    ] ) }'&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[ <span class="ruby-value">:load_text_url</span>    ]

  <span class="ruby-identifier">js_options</span>[ <span class="ruby-string">'callback'</span>            ] = <span class="ruby-node">&quot;function(form) { return #{ options[ :with ] }; }&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[ <span class="ruby-value">:with</span> ]

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[ <span class="ruby-value">:is_boolean</span> ]
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[ <span class="ruby-value">:start_value</span> ]
      <span class="ruby-identifier">js_options</span>[ <span class="ruby-string">'collection'</span> ] = <span class="ruby-string">&quot;[['true','Yes'],['false','No']]&quot;</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">js_options</span>[ <span class="ruby-string">'collection'</span> ] = <span class="ruby-string">&quot;[['false','No'],['true','Yes']]&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Set up the custom on-failure and on-complete handlers</span>

  <span class="ruby-identifier">js_options</span>[ <span class="ruby-string">'onFailure'</span> ] = <span class="ruby-node">&quot;#{ options[ :on_failure ] }&quot;</span>

  <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">options</span>.<span class="ruby-identifier">include?</span>( <span class="ruby-value">:lock_var</span> ) )
    <span class="ruby-identifier">js_options</span>[<span class="ruby-string">'onComplete'</span>] = <span class="ruby-node">&quot;function(transport, element) {#{ options[ :on_complete ] }(transport,element,'#{ options[ :lock_var ] }');}&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">js_options</span>[<span class="ruby-string">'onComplete'</span>] = <span class="ruby-node">&quot;#{ options[ :on_complete ] }&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Assemble the content</span>

  <span class="ruby-identifier">function</span> <span class="ruby-operator">&lt;&lt;</span> ( <span class="ruby-string">', '</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">options_for_javascript</span>( <span class="ruby-identifier">js_options</span> ) ) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">js_options</span>.<span class="ruby-identifier">empty?</span>
  <span class="ruby-identifier">function</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">')'</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">javascript_tag</span>( <span class="ruby-identifier">function</span> )
<span class="ruby-keyword">end</span></pre>
          </div><!-- safe_in_place_editor-source -->
          
        </div>

        

        
      </div><!-- safe_in_place_editor-method -->

    
      <div id="method-i-safe_in_place_editor_field" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">safe_in_place_editor_field</span><span
            class="method-args">( object, method, tag_options = {}, editor_options = {}, no_escape = false )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Close API equivalent of in_place_editor_field, except fixes various bugs
(see the README for rationale). Allows either an object name in the first
parameter (e.g. “:foo”, in which case instance variable “@foo” must point
to the object instance of interest) or an object instance (to save messing
around with magic instance variables, but obtains the object name from
“class.name.underscore”, so may not be appropriate for unusual object
classes). Anyway, clearer error reporting and the ability to pass in an
object reference directly may help avoid a common error experienced with
the InPlaceEditing plug-in code, as described here at the time of writing:</p>

<p><a
href="http://oldwiki.rubyonrails.org/rails/pages/InPlaceEditing">oldwiki.rubyonrails.org/rails/pages/InPlaceEditing</a></p>

<p>Includes the following options:</p>
<ul><li>
<p>:lock_var is the name of the variable used for optimistic locking, by
default set to a row-unique value. The assumption is that this same
variable gets used throughout the row so that multiple edits on that row
all cause the same variable to be incremented. If your back-end update
function has side effects that might invalidate the value shown in another
column on that row - which would be pretty strange! - you’d need to
override the lock variable name with something that’s unique to both the
row and the column. When using a lock variable, additional option
“:lock_version” is always set internally to the lock version of the object
for which the field is being built and cannot be overridden.</p>
</li><li>
<p>:with is extended to include a “lock_version” parameter in the query string
so that the client side’s idea of the current object’s lock version may be
communicated to the server’s attribute update action. This is done
internally; there is no need to set the option yourself.</p>
</li></ul>

<p>The editor options also support “is_boolean”, which overrides the default
setting of whether or not the column value is considered to be a string or
a boolean quantity. This is provided just-in-case, with no current known
cases where the automatic detection isn’t sufficient.</p>

<p>The Prototype library getText function must be patched as described in the
README rationale; “application.js” is a good place to do this.</p>

<p>Note an optional fifth parameter which if ‘true’ will prevent HTML escaping
of the value for values which are really meant to contain HTML code. Be
very, very careful with this.</p>
          

          
          <div class="method-source-code" id="safe_in_place_editor_field-source">
            <pre><span class="ruby-comment"># File lib/safe_in_place_editing/safe_in_place_editing_helper.rb, line 168</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">safe_in_place_editor_field</span>( <span class="ruby-identifier">object</span>, <span class="ruby-identifier">method</span>, <span class="ruby-identifier">tag_options</span> = {}, <span class="ruby-identifier">editor_options</span> = {}, <span class="ruby-identifier">no_escape</span> = <span class="ruby-keyword">false</span> )

  <span class="ruby-comment"># Allow a symbol or object instance to be passed. Since the symbol use</span>
  <span class="ruby-comment"># case involves accessing a 'magic' related instance variable name and</span>
  <span class="ruby-comment"># since there are lots of examples via Google of this confusing people,</span>
  <span class="ruby-comment"># raise a helpful error message if the relevant variable is missing.</span>

  <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">object</span>.<span class="ruby-identifier">instance_of?</span>( <span class="ruby-constant">Symbol</span> ) )
    <span class="ruby-identifier">object_name</span> = <span class="ruby-identifier">object</span>
    <span class="ruby-identifier">var_name</span> = <span class="ruby-node">&quot;@#{ object_name }&quot;</span>
    <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">instance_variable_defined?</span>( <span class="ruby-identifier">var_name</span> ) )
      <span class="ruby-identifier">object</span> = <span class="ruby-identifier">instance_variable_get</span>( <span class="ruby-identifier">var_name</span> )
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">raise</span>( <span class="ruby-string">'If passing \:foo\ to in_place_editor_field, \@foo\ must refer to the object for which the field is being built'</span> )
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">object_name</span> = <span class="ruby-identifier">object</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">underscore</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Pass the lock version in for optimistic locking support, should the</span>
  <span class="ruby-comment"># object support it. The update callback function must manually compare</span>
  <span class="ruby-comment"># the params[ :lock_version ] value against the lock_version.to_s()</span>
  <span class="ruby-comment"># value of the object that's being updated.</span>

  <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">object</span>.<span class="ruby-identifier">respond_to?</span>( <span class="ruby-value">:lock_version</span> ) )
    <span class="ruby-identifier">var</span> = <span class="ruby-node">&quot;#{ object_name }_#{ object.id }_safeInPlaceEditorLockVersion&quot;</span>

    <span class="ruby-identifier">editor_options</span>[ <span class="ruby-value">:lock_version</span> ]   = <span class="ruby-identifier">object</span>.<span class="ruby-identifier">lock_version</span>.<span class="ruby-identifier">to_s</span>
    <span class="ruby-identifier">editor_options</span>[ <span class="ruby-value">:lock_var</span>     ] <span class="ruby-operator">||=</span> <span class="ruby-identifier">var</span>
    <span class="ruby-identifier">editor_options</span>[ <span class="ruby-value">:with</span>         ] <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;Form.serialize(form).replace(/\\+/g,'%20')&quot;</span>
    <span class="ruby-identifier">editor_options</span>[ <span class="ruby-value">:with</span>         ]  <span class="ruby-operator">+=</span> <span class="ruby-node">&quot; + '&amp;lock_version=' + #{ var }&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Escape the value unless told not to and construct the complete in-place</span>
  <span class="ruby-comment"># editor assembly. Check for boolean values too, allowing caller-override.</span>

  <span class="ruby-identifier">column_value</span> = <span class="ruby-identifier">object</span>.<span class="ruby-identifier">send</span>( <span class="ruby-identifier">method</span> )

  <span class="ruby-identifier">is_boolean</span> = ( <span class="ruby-identifier">editor_options</span>[ <span class="ruby-value">:is_boolean</span> ] <span class="ruby-operator">||</span> ( <span class="ruby-identifier">column_value</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">TrueClass</span> ) <span class="ruby-operator">||</span> ( <span class="ruby-identifier">column_value</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">FalseClass</span> ) )

  <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">is_boolean</span> )
    <span class="ruby-identifier">editor_options</span>[ <span class="ruby-value">:start_value</span> ] = <span class="ruby-operator">!</span><span class="ruby-operator">!</span> <span class="ruby-identifier">column_value</span>
    <span class="ruby-identifier">column_value</span> = <span class="ruby-identifier">column_value</span> <span class="ruby-operator">?</span> <span class="ruby-string">'Yes'</span> <span class="ruby-operator">:</span> <span class="ruby-string">'No'</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">column_value</span> = <span class="ruby-constant">ERB</span><span class="ruby-operator">::</span><span class="ruby-constant">Util</span><span class="ruby-operator">::</span><span class="ruby-identifier">html_escape</span>( <span class="ruby-identifier">column_value</span> ) <span class="ruby-keyword">unless</span> ( <span class="ruby-identifier">no_escape</span> )
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">tag_options</span> = {
    <span class="ruby-value">:id</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{object_name}_#{method}_#{object.id}_in_place_editor&quot;</span>,
    <span class="ruby-value">:class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;in_place_editor_field&quot;</span>
  }.<span class="ruby-identifier">merge!</span>( <span class="ruby-identifier">tag_options</span> )

  <span class="ruby-identifier">editor_options</span>[ <span class="ruby-value">:url</span> ] <span class="ruby-operator">||=</span> <span class="ruby-identifier">url_for</span>( {
    <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;set_#{object_name}_#{method}&quot;</span>,
    <span class="ruby-value">:id</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">object</span>.<span class="ruby-identifier">id</span>
  } )

  <span class="ruby-comment"># Update the boolean value flag, unless the caller had already set one.</span>

  <span class="ruby-identifier">editor_options</span>[ <span class="ruby-value">:is_boolean</span> ] = <span class="ruby-identifier">is_boolean</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">editor_options</span>.<span class="ruby-identifier">has_key?</span>( <span class="ruby-value">:is_boolean</span> )

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">content_tag</span>( <span class="ruby-value">:span</span>, <span class="ruby-identifier">column_value</span>.<span class="ruby-identifier">html_safe</span>, <span class="ruby-identifier">tag_options</span> ) <span class="ruby-operator">+</span>
         <span class="ruby-identifier">safe_in_place_editor</span>( <span class="ruby-identifier">tag_options</span>[ <span class="ruby-value">:id</span> ], <span class="ruby-identifier">editor_options</span> )
<span class="ruby-keyword">end</span></pre>
          </div><!-- safe_in_place_editor_field-source -->
          
        </div>

        

        
      </div><!-- safe_in_place_editor_field-method -->

    
    </section><!-- public-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.12.2.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

