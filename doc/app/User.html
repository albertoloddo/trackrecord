<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">

<title>class User - TrackRecord</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>app/models/user.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link"><a href="Rangeable.html">Rangeable</a>
  
</nav>

    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-c-new">::new</a>
    
    <li><a href="#method-c-rationalise_id">::rationalise_id</a>
    
    <li><a href="#method-i-active_permitted_tasks">#active_permitted_tasks</a>
    
    <li><a href="#method-i-admin-3F">#admin?</a>
    
    <li><a href="#method-i-all_permitted_tasks">#all_permitted_tasks</a>
    
    <li><a href="#method-i-authenticate">#authenticate</a>
    
    <li><a href="#method-i-has_validated_password-3F">#has_validated_password?</a>
    
    <li><a href="#method-i-manager-3F">#manager?</a>
    
    <li><a href="#method-i-plaintext_password">#plaintext_password</a>
    
    <li><a href="#method-i-privileged-3F">#privileged?</a>
    
    <li><a href="#method-i-remove_inactive_tasks">#remove_inactive_tasks</a>
    
    <li><a href="#method-i-restricted-3F">#restricted?</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="./CHANGELOG_rdoc.html">CHANGELOG</a>
  
    <li class="file"><a href="./README_rdoc.html">README</a>
  
    <li class="file"><a href="./doc/README_FOR_APP_rdoc.html">README_FOR_APP</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./TrackRecordReport.html">TrackRecordReport</a>
  
    <li><a href="./TrackRecordReport/Calculator.html">TrackRecordReport::Calculator</a>
  
    <li><a href="./TrackRecordReport/CalculatorWithUsers.html">TrackRecordReport::CalculatorWithUsers</a>
  
    <li><a href="./TrackRecordReport/Cell.html">TrackRecordReport::Cell</a>
  
    <li><a href="./TrackRecordReport/Report.html">TrackRecordReport::Report</a>
  
    <li><a href="./TrackRecordReport/Row.html">TrackRecordReport::Row</a>
  
    <li><a href="./TrackRecordReport/Section.html">TrackRecordReport::Section</a>
  
    <li><a href="./TrackRecordSections.html">TrackRecordSections</a>
  
    <li><a href="./TrackRecordSections/Group.html">TrackRecordSections::Group</a>
  
    <li><a href="./TrackRecordSections/GroupMixin.html">TrackRecordSections::GroupMixin</a>
  
    <li><a href="./TrackRecordSections/Section.html">TrackRecordSections::Section</a>
  
    <li><a href="./TrackRecordSections/SectionMixin.html">TrackRecordSections::SectionMixin</a>
  
    <li><a href="./TrackRecordSections/Sections.html">TrackRecordSections::Sections</a>
  
    <li><a href="./TrackRecordSections/SectionsMixin.html">TrackRecordSections::SectionsMixin</a>
  
    <li><a href="./ReportsHelper.html">ReportsHelper</a>
  
    <li><a href="./ReportsHelper/ReportMonth.html">ReportsHelper::ReportMonth</a>
  
    <li><a href="./ReportsHelper/ReportWeek.html">ReportsHelper::ReportWeek</a>
  
    <li><a href="./ReportsHelper/ReportYear.html">ReportsHelper::ReportYear</a>
  
    <li><a href="./QuietLeightbox.html">QuietLeightbox</a>
  
    <li><a href="./QuietLeightbox/ClassMethods.html">QuietLeightbox::ClassMethods</a>
  
    <li><a href="./QuietLeightbox/QuietLeightboxHelper.html">QuietLeightbox::QuietLeightboxHelper</a>
  
    <li><a href="./QuietPrototype.html">QuietPrototype</a>
  
    <li><a href="./QuietPrototype/ClassMethods.html">QuietPrototype::ClassMethods</a>
  
    <li><a href="./QuietPrototype/QuietPrototypeHelper.html">QuietPrototype::QuietPrototypeHelper</a>
  
    <li><a href="./YuiTree.html">YuiTree</a>
  
    <li><a href="./YuiTree/ClassMethods.html">YuiTree::ClassMethods</a>
  
    <li><a href="./YuiTree/YuiTreeHelper.html">YuiTree::YuiTreeHelper</a>
  
    <li><a href="./TrackRecordReportGenerator.html">TrackRecordReportGenerator</a>
  
    <li><a href="./TrackRecordReportGenerator/UkOrgPondCSV.html">TrackRecordReportGenerator::UkOrgPondCSV</a>
  
    <li><a href="./ApplicationController.html">ApplicationController</a>
  
    <li><a href="./ApplicationHelper.html">ApplicationHelper</a>
  
    <li><a href="./AuditsController.html">AuditsController</a>
  
    <li><a href="./AuditsHelper.html">AuditsHelper</a>
  
    <li><a href="./ChartsController.html">ChartsController</a>
  
    <li><a href="./ChartsHelper.html">ChartsHelper</a>
  
    <li><a href="./ControlPanel.html">ControlPanel</a>
  
    <li><a href="./ControlPanelsController.html">ControlPanelsController</a>
  
    <li><a href="./Customer.html">Customer</a>
  
    <li><a href="./CustomersController.html">CustomersController</a>
  
    <li><a href="./CustomersHelper.html">CustomersHelper</a>
  
    <li><a href="./EmailNotifier.html">EmailNotifier</a>
  
    <li><a href="./HelpController.html">HelpController</a>
  
    <li><a href="./HelpHelper.html">HelpHelper</a>
  
    <li><a href="./Project.html">Project</a>
  
    <li><a href="./ProjectsController.html">ProjectsController</a>
  
    <li><a href="./ProjectsHelper.html">ProjectsHelper</a>
  
    <li><a href="./Rangeable.html">Rangeable</a>
  
    <li><a href="./ReportsController.html">ReportsController</a>
  
    <li><a href="./SavedReport.html">SavedReport</a>
  
    <li><a href="./SavedReportAutoTitlesController.html">SavedReportAutoTitlesController</a>
  
    <li><a href="./SavedReportsBaseController.html">SavedReportsBaseController</a>
  
    <li><a href="./SavedReportsByCustomerController.html">SavedReportsByCustomerController</a>
  
    <li><a href="./SavedReportsByProjectController.html">SavedReportsByProjectController</a>
  
    <li><a href="./SavedReportsByTaskController.html">SavedReportsByTaskController</a>
  
    <li><a href="./SavedReportsByUserController.html">SavedReportsByUserController</a>
  
    <li><a href="./SavedReportsController.html">SavedReportsController</a>
  
    <li><a href="./SavedReportsHelper.html">SavedReportsHelper</a>
  
    <li><a href="./SessionsController.html">SessionsController</a>
  
    <li><a href="./SignIn.html">SignIn</a>
  
    <li><a href="./Task.html">Task</a>
  
    <li><a href="./TaskGroup.html">TaskGroup</a>
  
    <li><a href="./TaskImport.html">TaskImport</a>
  
    <li><a href="./TaskImportsController.html">TaskImportsController</a>
  
    <li><a href="./TaskImportsHelper.html">TaskImportsHelper</a>
  
    <li><a href="./TasksController.html">TasksController</a>
  
    <li><a href="./TasksHelper.html">TasksHelper</a>
  
    <li><a href="./Timesheet.html">Timesheet</a>
  
    <li><a href="./TimesheetForceCommit.html">TimesheetForceCommit</a>
  
    <li><a href="./TimesheetForceCommitsController.html">TimesheetForceCommitsController</a>
  
    <li><a href="./TimesheetRow.html">TimesheetRow</a>
  
    <li><a href="./TimesheetRowsController.html">TimesheetRowsController</a>
  
    <li><a href="./TimesheetRowsHelper.html">TimesheetRowsHelper</a>
  
    <li><a href="./TimesheetsController.html">TimesheetsController</a>
  
    <li><a href="./TimesheetsHelper.html">TimesheetsHelper</a>
  
    <li><a href="./TreesController.html">TreesController</a>
  
    <li><a href="./User.html">User</a>
  
    <li><a href="./UsersController.html">UsersController</a>
  
    <li><a href="./UsersHelper.html">UsersHelper</a>
  
    <li><a href="./WorkPacket.html">WorkPacket</a>
  
    <li><a href="./WorkPacketsController.html">WorkPacketsController</a>
  
    <li><a href="./WorkPacketsHelper.html">WorkPacketsHelper</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class User</h1>

  <div id="description" class="description">
    <dl class="rdoc-list note-list"><dt>File
<dd>
<p>user.rb</p>
</dd><dt>(C)
<dd>
<p>Hipposoft 2008</p>
</dd><dt>Purpose
<dd>
<p>Describe the behaviour of <a href="User.html">User</a> objects. See below
for more details.</p>
</dd></dl>
<hr style="height: 10px">

<pre>03-Jan-2008 (ADH): Created.</pre>

  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <!-- Constants -->
    <section id="constants-list" class="section">
      <h3 class="section-header">Constants</h3>
      <dl>
      
        <dt id="DEFAULT_SORT_COLUMN">DEFAULT_SORT_COLUMN
        
        <dd class="description">
        
      
        <dt id="DEFAULT_SORT_DIRECTION">DEFAULT_SORT_DIRECTION
        
        <dd class="description">
        
      
        <dt id="DEFAULT_SORT_ORDER">DEFAULT_SORT_ORDER
        
        <dd class="description">
        
      
        <dt id="USED_RANGE_COLUMN">USED_RANGE_COLUMN
        
        <dd class="description">
        
      
        <dt id="USER_TYPE_ADMIN">USER_TYPE_ADMIN
        
        <dd class="description">
        
      
        <dt id="USER_TYPE_MANAGER">USER_TYPE_MANAGER
        
        <dd class="description">
        
      
        <dt id="USER_TYPE_NORMAL">USER_TYPE_NORMAL
        
        <dd class="description">
        
      
      </dl>
    </section>
    

    
    <!-- Attributes -->
    <section id="attribute-method-details" class="method-section section">
      <h3 class="section-header">Attributes</h3>

      
      <div id="attribute-i-new_password" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">new_password</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p>A user account has an optional secure password. This runs through BCrypt
behind the scenes. We don&#39;t use Rails 3&#39;s “has_secure_password”
because our model has unusual requirements and there are naming issues with
the BCrypt gem, which decided to rename itself at version 3.2.13, but Rails
at the time of writing still requires the old named version, which would
force us to use an outdated gem.</p>

<p>Instead, code in
&#39;activemodel-3.2.17/lib/active_model/secure_password.rb&#39; is adapted
here, where required <a
href="http://api.rubyonrails.org/classes/ActiveModel/SecurePassword/ClassMethods.html#method-i-has_secure_password">api.rubyonrails.org/classes/ActiveModel/SecurePassword/ClassMethods.html#method-i-has_secure_password</a>
<a
href="https://github.com/codahale/bcrypt-ruby/tree/master">github.com/codahale/bcrypt-ruby/tree/master</a></p>

<p>These accessors are for local use when forms are trying to change data.
Validations later add additional related accessors. Do not use the
“password” attribute to see if there&#39;s a password on an existing model;
use “has_validated_password?” insead.</p>
        
        </div>
      </div>
      
      <div id="attribute-i-old_password" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">old_password</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p>A user account has an optional secure password. This runs through BCrypt
behind the scenes. We don&#39;t use Rails 3&#39;s “has_secure_password”
because our model has unusual requirements and there are naming issues with
the BCrypt gem, which decided to rename itself at version 3.2.13, but Rails
at the time of writing still requires the old named version, which would
force us to use an outdated gem.</p>

<p>Instead, code in
&#39;activemodel-3.2.17/lib/active_model/secure_password.rb&#39; is adapted
here, where required <a
href="http://api.rubyonrails.org/classes/ActiveModel/SecurePassword/ClassMethods.html#method-i-has_secure_password">api.rubyonrails.org/classes/ActiveModel/SecurePassword/ClassMethods.html#method-i-has_secure_password</a>
<a
href="https://github.com/codahale/bcrypt-ruby/tree/master">github.com/codahale/bcrypt-ruby/tree/master</a></p>

<p>These accessors are for local use when forms are trying to change data.
Validations later add additional related accessors. Do not use the
“password” attribute to see if there&#39;s a password on an existing model;
use “has_validated_password?” insead.</p>
        
        </div>
      </div>
      
      <div id="attribute-i-password" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">password</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p>A user account has an optional secure password. This runs through BCrypt
behind the scenes. We don&#39;t use Rails 3&#39;s “has_secure_password”
because our model has unusual requirements and there are naming issues with
the BCrypt gem, which decided to rename itself at version 3.2.13, but Rails
at the time of writing still requires the old named version, which would
force us to use an outdated gem.</p>

<p>Instead, code in
&#39;activemodel-3.2.17/lib/active_model/secure_password.rb&#39; is adapted
here, where required <a
href="http://api.rubyonrails.org/classes/ActiveModel/SecurePassword/ClassMethods.html#method-i-has_secure_password">api.rubyonrails.org/classes/ActiveModel/SecurePassword/ClassMethods.html#method-i-has_secure_password</a>
<a
href="https://github.com/codahale/bcrypt-ruby/tree/master">github.com/codahale/bcrypt-ruby/tree/master</a></p>

<p>These accessors are for local use when forms are trying to change data.
Validations later add additional related accessors. Do not use the
“password” attribute to see if there&#39;s a password on an existing model;
use “has_validated_password?” insead.</p>
        
        </div>
      </div>
      
    </section><!-- attribute-method-details -->
    

    <!-- Methods -->
    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Class Methods</h3>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">( params = nil, user = nil )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Some default properties are dynamic, so assign these here rather than as
defaults in a migration.</p>

<p>Parameters:</p>

<pre>Optional hash used for instance initialisation in the traditional way
for an ActiveRecord subclass.

Optional User object. Default data from a user control panel may be used
for the new object in future, though presently this parameter is ignored.</pre>
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 211</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>( <span class="ruby-identifier">params</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">user</span> = <span class="ruby-keyword">nil</span> )
  <span class="ruby-keyword">super</span>( <span class="ruby-identifier">params</span> )

  <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">params</span>.<span class="ruby-identifier">nil?</span> )
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">code</span>         = <span class="ruby-string">&quot;UID%04d&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-constant">User</span>.<span class="ruby-identifier">count</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">active</span>       = <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">name</span>         = <span class="ruby-string">&#39;&#39;</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">email</span>        = <span class="ruby-string">&#39;&#39;</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">identity_url</span> = <span class="ruby-string">&#39;&#39;</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">user_type</span>    = <span class="ruby-constant">User</span><span class="ruby-operator">::</span><span class="ruby-constant">USER_TYPE_NORMAL</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- new-source -->
          
        </div>

        

        
      </div><!-- new-method -->

    
      <div id="method-c-rationalise_id" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">rationalise_id</span><span
            class="method-args">( uri )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Class method - rationalise a URL for use with Open ID by ensuring that the
scheme and host are in lower case, the port nubmer is explicit and query or
fragment strings are stripped out. Only call for HTTP or HTTPS URLs. If
given &#39;nil&#39;, returns &#39;nil&#39;. If given something with no
apparent scheme, assumes &#39;HTTP&#39;.</p>
          

          
          <div class="method-source-code" id="rationalise_id-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 352</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">rationalise_id</span>( <span class="ruby-identifier">uri</span> )
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">nil?</span> )

  <span class="ruby-identifier">uri</span>      = <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">strip</span>
  <span class="ruby-identifier">original</span> = <span class="ruby-constant">URI</span>.<span class="ruby-identifier">parse</span>( <span class="ruby-identifier">uri</span> )

  <span class="ruby-comment"># Did the user omit the &#39;http&#39; prefix? If so, the URI parser will</span>
  <span class="ruby-comment"># be a bit confused. Try adding in &#39;http&#39; instead.</span>

  <span class="ruby-identifier">original</span> = <span class="ruby-constant">URI</span>.<span class="ruby-identifier">parse</span>( <span class="ruby-node">&quot;http://#{uri}&quot;</span> ) <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">original</span>.<span class="ruby-identifier">scheme</span>.<span class="ruby-identifier">nil?</span> )

  <span class="ruby-comment"># We must by now have at least a scheme and host. If not, something</span>
  <span class="ruby-comment"># very odd is going on - bail out.</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">uri</span> <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">original</span>.<span class="ruby-identifier">scheme</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">original</span>.<span class="ruby-identifier">host</span>.<span class="ruby-identifier">nil?</span> )

  <span class="ruby-identifier">original</span>.<span class="ruby-identifier">path</span>.<span class="ruby-identifier">chomp!</span>( <span class="ruby-string">&#39;/&#39;</span> )

  <span class="ruby-comment"># Looks good - assemble a clean equivalent.</span>

  <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">original</span>.<span class="ruby-identifier">scheme</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;https&#39;</span> )
    <span class="ruby-identifier">mod</span> = <span class="ruby-constant">URI</span><span class="ruby-operator">::</span><span class="ruby-constant">HTTPS</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">mod</span> = <span class="ruby-constant">URI</span><span class="ruby-operator">::</span><span class="ruby-constant">HTTP</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">rational</span> = <span class="ruby-identifier">mod</span>.<span class="ruby-identifier">build</span>( {
    <span class="ruby-value">:scheme</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">original</span>.<span class="ruby-identifier">scheme</span>.<span class="ruby-identifier">downcase</span>,
    <span class="ruby-value">:host</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">original</span>.<span class="ruby-identifier">host</span>.<span class="ruby-identifier">downcase</span>,
    <span class="ruby-value">:port</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">original</span>.<span class="ruby-identifier">port</span>,
    <span class="ruby-value">:path</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">original</span>.<span class="ruby-identifier">path</span>
  } )

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">rational</span>.<span class="ruby-identifier">to_s</span>()

<span class="ruby-keyword">rescue</span>

  <span class="ruby-comment"># Catch URI parser exceptions by just bailing out</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">uri</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- rationalise_id-source -->
          
        </div>

        

        
      </div><!-- rationalise_id-method -->

    
    </section><!-- public-class-method-details -->
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-active_permitted_tasks" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">active_permitted_tasks</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Find all tasks which this user is permitted to see; only active tasks are
returned. Returns an association-like object on which other methods may be
called, e.g. a “find” call, a “count” (for efficient counting of items
without needing a special additional count method), and so-on.</p>

<p>Call this rather than “user.tasks.active” if you want to retrieve valid
task lists even for privileged users, where otherwise there may be no
assigned task list (since privileged users can view anything anyway) and
“user.tasks” would thus return nothing. Note that the actual assigned task
list for privileged users, if any, will be IGNORED by this call.</p>
          

          
          <div class="method-source-code" id="active_permitted_tasks-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 291</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">active_permitted_tasks</span>
  ( <span class="ruby-keyword">self</span>.<span class="ruby-identifier">restricted?</span> ) <span class="ruby-operator">?</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">tasks</span>.<span class="ruby-identifier">active</span> <span class="ruby-operator">:</span> <span class="ruby-constant">Task</span>.<span class="ruby-identifier">active</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- active_permitted_tasks-source -->
          
        </div>

        

        
      </div><!-- active_permitted_tasks-method -->

    
      <div id="method-i-admin-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">admin?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Is this user an administrator? This generally means full read/write system
access. This does given the potential to completely break the system (e.g.
delete a user&#39;s control panel but not the user), although steps are
taken to try and protect against it. In the end, though, an administrator
is assumed to be With Clue.</p>

<p>See also “privileged?” and “manager?”. Administrators are considered to be
both managers and privileged.</p>
          

          
          <div class="method-source-code" id="admin-3F-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 336</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">admin?</span>
  <span class="ruby-keyword">return</span> ( <span class="ruby-keyword">self</span>.<span class="ruby-identifier">user_type</span> <span class="ruby-operator">==</span> <span class="ruby-constant">User</span><span class="ruby-operator">::</span><span class="ruby-constant">USER_TYPE_ADMIN</span> )
<span class="ruby-keyword">end</span></pre>
          </div><!-- admin-3F-source -->
          
        </div>

        

        
      </div><!-- admin-3F-method -->

    
      <div id="method-i-all_permitted_tasks" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">all_permitted_tasks</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>As &#39;permitted_tasks&#39; above, but returns details for both active and
inactive tasks.</p>
          

          
          <div class="method-source-code" id="all_permitted_tasks-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 298</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">all_permitted_tasks</span>
  ( <span class="ruby-keyword">self</span>.<span class="ruby-identifier">restricted?</span> ) <span class="ruby-operator">?</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">tasks</span>.<span class="ruby-identifier">scoped</span> <span class="ruby-operator">:</span> <span class="ruby-constant">Task</span>.<span class="ruby-identifier">scoped</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- all_permitted_tasks-source -->
          
        </div>

        

        
      </div><!-- all_permitted_tasks-method -->

    
      <div id="method-i-authenticate" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">authenticate</span><span
            class="method-args">( unencrypted_password )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Returns self if the password is correct, otherwise false. Taken from
&#39;activemodel-3.2.17/lib/active_model/secure_password.rb&#39;.</p>
          

          
          <div class="method-source-code" id="authenticate-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 227</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">authenticate</span>( <span class="ruby-identifier">unencrypted_password</span> )
  <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">has_validated_password?</span> <span class="ruby-keyword">and</span> <span class="ruby-constant">BCrypt</span><span class="ruby-operator">::</span><span class="ruby-constant">Password</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">password_digest</span> ) <span class="ruby-operator">==</span> <span class="ruby-identifier">unencrypted_password</span> )
    <span class="ruby-keyword">self</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- authenticate-source -->
          
        </div>

        

        
      </div><!-- authenticate-method -->

    
      <div id="method-i-has_validated_password-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">has_validated_password?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Did this instance have a valid password set at the time it was loaded from
the database? (Note that the “password” attribute MUST NOT be used for that
check as most of the time it&#39;ll be &#39;nil&#39;; note also that it is
never possible to retrieve the decrypted value of a password from the
database&#39;s encrypted copy; all we can do is take a user-supplied
password, encrypt it and see if the result matches the stored digest).</p>

<p>Note that locally setting a password which is not yet persisted in the
database (and thus may not yet have been validated) will NOT result in a
&#39;true&#39; response from this method.</p>
          

          
          <div class="method-source-code" id="has_validated_password-3F-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 246</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">has_validated_password?</span>

  <span class="ruby-comment"># There are other ways to do this (e.g. &quot;password_digest?&quot; instead of</span>
  <span class="ruby-comment"># &quot;!! password_digest&quot;) but I felt this was the most legible.</span>

  <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">password_digest_changed?</span> )
    <span class="ruby-operator">!</span><span class="ruby-operator">!</span> <span class="ruby-identifier">password_digest_was</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-operator">!</span><span class="ruby-operator">!</span> <span class="ruby-identifier">password_digest</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- has_validated_password-3F-source -->
          
        </div>

        

        
      </div><!-- has_validated_password-3F-method -->

    
      <div id="method-i-manager-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">manager?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Is this user a manager? This generally means elevated privileges but still
no full read/write system access for safety. See also “privileged?” -
manager accounts are considered privileged.</p>

<p>Administrators acquire manager privileges in passing.</p>
          

          
          <div class="method-source-code" id="manager-3F-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 323</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">manager?</span>
  <span class="ruby-keyword">return</span> ( <span class="ruby-keyword">self</span>.<span class="ruby-identifier">user_type</span> <span class="ruby-operator">==</span> <span class="ruby-constant">User</span><span class="ruby-operator">::</span><span class="ruby-constant">USER_TYPE_MANAGER</span> <span class="ruby-keyword">or</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">user_type</span> <span class="ruby-operator">==</span> <span class="ruby-constant">User</span><span class="ruby-operator">::</span><span class="ruby-constant">USER_TYPE_ADMIN</span> )
<span class="ruby-keyword">end</span></pre>
          </div><!-- manager-3F-source -->
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="User.html#method-i-privileged-3F">privileged?</a>
        </div>
        

        
      </div><!-- manager-3F-method -->

    
      <div id="method-i-plaintext_password" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">plaintext_password</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Ask for the plaintext password - only possible on a user instance where the
“password” or “<a
href="User.html#attribute-i-new_password">#new_password</a>” attribute has
been actively <strong>set</strong>. The “password” attribute is returned in
favour of “<a href="User.html#attribute-i-new_password">#new_password</a>”
if they are both present.</p>

<p>A new <a href="User.html">User</a> record from the database will never be
able to return this data. It&#39;s only for use when you have a
new-password / changed-password scenario in an existing instance and need
to retrieve the value.</p>

<p>Never use this to determine if a validated, in-database password exists for
the user. Always use “has_validated_password?” for that instead.</p>
          

          
          <div class="method-source-code" id="plaintext_password-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 270</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">plaintext_password</span>
  
  <span class="ruby-comment"># Do this rather than &quot;password || new_password&quot; so that an empty</span>
  <span class="ruby-comment"># string in &quot;password&quot; is *not* returned in favour of something more</span>
  <span class="ruby-comment"># significant in &quot;new_password&quot;.</span>
  
  <span class="ruby-identifier">password</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">new_password</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">password</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- plaintext_password-source -->
          
        </div>

        

        
      </div><!-- plaintext_password-method -->

    
      <div id="method-i-privileged-3F" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">privileged?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Is this user <strong>not</strong> restricted? Means the same thing as
“manager?” in practice since administrators are also managers, but use of
this alias can lead to more legible code.</p>
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="User.html#method-i-manager-3F">manager?</a>
        </div>
        
      </div><!-- privileged-3F-method -->

    
      <div id="method-i-remove_inactive_tasks" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">remove_inactive_tasks</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Remove inactive tasks from a user&#39;s tasks list. The caller is
responsible for saving the updated object.</p>
          

          
          <div class="method-source-code" id="remove_inactive_tasks-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 305</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">remove_inactive_tasks</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">tasks</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">tasks</span>.<span class="ruby-identifier">active</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- remove_inactive_tasks-source -->
          
        </div>

        

        
      </div><!-- remove_inactive_tasks-method -->

    
      <div id="method-i-restricted-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">restricted?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Is this user restricted? This generally means they can only see anything
related to tasks belonging to this user, which only a manager or
administrator can assign. See also “privileged?”.</p>
          

          
          <div class="method-source-code" id="restricted-3F-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 313</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">restricted?</span>
  <span class="ruby-keyword">return</span> ( <span class="ruby-keyword">self</span>.<span class="ruby-identifier">user_type</span> <span class="ruby-operator">==</span> <span class="ruby-constant">User</span><span class="ruby-operator">::</span><span class="ruby-constant">USER_TYPE_NORMAL</span> )
<span class="ruby-keyword">end</span></pre>
          </div><!-- restricted-3F-source -->
          
        </div>

        

        
      </div><!-- restricted-3F-method -->

    
    </section><!-- public-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.12.2.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

