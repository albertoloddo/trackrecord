<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">

<title>module YuiTree::ClassMethods - YOUR_TITLE</title>

<link type="text/css" media="screen" href="../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
</script>

<script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/darkfish.js"></script>


<body id="top" class="module">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="../index.html">Home</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>lib/yui_tree/yui_tree.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    
    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-i-uses_yui_tree">#uses_yui_tree</a>
    
    <li><a href="#method-i-yui_tree_handled_xhr_request-3F">#yui_tree_handled_xhr_request?</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="../doc/README_FOR_APP.html">README_FOR_APP</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="../TrackRecordReport.html">TrackRecordReport</a>
  
    <li><a href="../TrackRecordReport/Calculator.html">TrackRecordReport::Calculator</a>
  
    <li><a href="../TrackRecordReport/CalculatorWithUsers.html">TrackRecordReport::CalculatorWithUsers</a>
  
    <li><a href="../TrackRecordReport/Cell.html">TrackRecordReport::Cell</a>
  
    <li><a href="../TrackRecordReport/Report.html">TrackRecordReport::Report</a>
  
    <li><a href="../TrackRecordReport/Row.html">TrackRecordReport::Row</a>
  
    <li><a href="../TrackRecordReport/Section.html">TrackRecordReport::Section</a>
  
    <li><a href="../TrackRecordSections.html">TrackRecordSections</a>
  
    <li><a href="../TrackRecordSections/Group.html">TrackRecordSections::Group</a>
  
    <li><a href="../TrackRecordSections/GroupMixin.html">TrackRecordSections::GroupMixin</a>
  
    <li><a href="../TrackRecordSections/Section.html">TrackRecordSections::Section</a>
  
    <li><a href="../TrackRecordSections/SectionMixin.html">TrackRecordSections::SectionMixin</a>
  
    <li><a href="../TrackRecordSections/Sections.html">TrackRecordSections::Sections</a>
  
    <li><a href="../TrackRecordSections/SectionsMixin.html">TrackRecordSections::SectionsMixin</a>
  
    <li><a href="../ReportsHelper.html">ReportsHelper</a>
  
    <li><a href="../ReportsHelper/ReportMonth.html">ReportsHelper::ReportMonth</a>
  
    <li><a href="../ReportsHelper/ReportWeek.html">ReportsHelper::ReportWeek</a>
  
    <li><a href="../ReportsHelper/ReportYear.html">ReportsHelper::ReportYear</a>
  
    <li><a href="../QuietLeightbox.html">QuietLeightbox</a>
  
    <li><a href="../QuietLeightbox/ClassMethods.html">QuietLeightbox::ClassMethods</a>
  
    <li><a href="../QuietLeightbox/QuietLeightboxHelper.html">QuietLeightbox::QuietLeightboxHelper</a>
  
    <li><a href="../QuietPrototype.html">QuietPrototype</a>
  
    <li><a href="../QuietPrototype/ClassMethods.html">QuietPrototype::ClassMethods</a>
  
    <li><a href="../QuietPrototype/QuietPrototypeHelper.html">QuietPrototype::QuietPrototypeHelper</a>
  
    <li><a href="../TrackRecordReportGenerator.html">TrackRecordReportGenerator</a>
  
    <li><a href="../TrackRecordReportGenerator/UkOrgPondCSV.html">TrackRecordReportGenerator::UkOrgPondCSV</a>
  
    <li><a href="../TrackRecordReportGenerator/UkOrgPondCSVAsDays.html">TrackRecordReportGenerator::UkOrgPondCSVAsDays</a>
  
    <li><a href="../YuiTree.html">YuiTree</a>
  
    <li><a href="../YuiTree/ClassMethods.html">YuiTree::ClassMethods</a>
  
    <li><a href="../YuiTree/YuiTreeHelper.html">YuiTree::YuiTreeHelper</a>
  
    <li><a href="../ApplicationController.html">ApplicationController</a>
  
    <li><a href="../ApplicationHelper.html">ApplicationHelper</a>
  
    <li><a href="../AuditsController.html">AuditsController</a>
  
    <li><a href="../AuditsHelper.html">AuditsHelper</a>
  
    <li><a href="../ChartsController.html">ChartsController</a>
  
    <li><a href="../ChartsHelper.html">ChartsHelper</a>
  
    <li><a href="../ControlPanel.html">ControlPanel</a>
  
    <li><a href="../ControlPanelsController.html">ControlPanelsController</a>
  
    <li><a href="../Customer.html">Customer</a>
  
    <li><a href="../CustomersController.html">CustomersController</a>
  
    <li><a href="../CustomersHelper.html">CustomersHelper</a>
  
    <li><a href="../EmailNotifier.html">EmailNotifier</a>
  
    <li><a href="../HelpController.html">HelpController</a>
  
    <li><a href="../HelpHelper.html">HelpHelper</a>
  
    <li><a href="../Project.html">Project</a>
  
    <li><a href="../ProjectsController.html">ProjectsController</a>
  
    <li><a href="../ProjectsHelper.html">ProjectsHelper</a>
  
    <li><a href="../Rangeable.html">Rangeable</a>
  
    <li><a href="../ReportsController.html">ReportsController</a>
  
    <li><a href="../SavedReport.html">SavedReport</a>
  
    <li><a href="../SavedReportAutoTitlesController.html">SavedReportAutoTitlesController</a>
  
    <li><a href="../SavedReportsBaseController.html">SavedReportsBaseController</a>
  
    <li><a href="../SavedReportsByCustomerController.html">SavedReportsByCustomerController</a>
  
    <li><a href="../SavedReportsByProjectController.html">SavedReportsByProjectController</a>
  
    <li><a href="../SavedReportsByTaskController.html">SavedReportsByTaskController</a>
  
    <li><a href="../SavedReportsByUserController.html">SavedReportsByUserController</a>
  
    <li><a href="../SavedReportsController.html">SavedReportsController</a>
  
    <li><a href="../SavedReportsHelper.html">SavedReportsHelper</a>
  
    <li><a href="../SessionsController.html">SessionsController</a>
  
    <li><a href="../Task.html">Task</a>
  
    <li><a href="../TaskGroup.html">TaskGroup</a>
  
    <li><a href="../TaskImport.html">TaskImport</a>
  
    <li><a href="../TaskImportsController.html">TaskImportsController</a>
  
    <li><a href="../TaskImportsHelper.html">TaskImportsHelper</a>
  
    <li><a href="../TasksController.html">TasksController</a>
  
    <li><a href="../TasksHelper.html">TasksHelper</a>
  
    <li><a href="../Timesheet.html">Timesheet</a>
  
    <li><a href="../TimesheetForceCommit.html">TimesheetForceCommit</a>
  
    <li><a href="../TimesheetForceCommitsController.html">TimesheetForceCommitsController</a>
  
    <li><a href="../TimesheetRow.html">TimesheetRow</a>
  
    <li><a href="../TimesheetRowsController.html">TimesheetRowsController</a>
  
    <li><a href="../TimesheetRowsHelper.html">TimesheetRowsHelper</a>
  
    <li><a href="../TimesheetsController.html">TimesheetsController</a>
  
    <li><a href="../TimesheetsHelper.html">TimesheetsHelper</a>
  
    <li><a href="../TreesController.html">TreesController</a>
  
    <li><a href="../User.html">User</a>
  
    <li><a href="../UsersController.html">UsersController</a>
  
    <li><a href="../UsersHelper.html">UsersHelper</a>
  
    <li><a href="../WorkPacket.html">WorkPacket</a>
  
    <li><a href="../WorkPacketsController.html">WorkPacketsController</a>
  
    <li><a href="../WorkPacketsHelper.html">WorkPacketsHelper</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="module">module YuiTree::ClassMethods</h1>

  <div id="description" class="description">
    
  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    <!-- Methods -->
    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-uses_yui_tree" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">uses_yui_tree</span><span
            class="method-args">( tree_options = {}, filter_options = {} )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Define the “<a
href="ClassMethods.html#method-i-uses_yui_tree">#uses_yui_tree</a>” class
method, which sets up instance variables “<code>@yui_tree_options</code>”
and “<code>@uses_yui_tree</code>” within any controller calling the method.
See “self.included” in the plugin code for more information.</p>

<p>The “<a href="ClassMethods.html#method-i-uses_yui_tree">#uses_yui_tree</a>”
method can be passed two optional options hashes. The first specifies
options for the YUI tree. The second is passed directly to the Rails <a
href="http://api.rubyonrails.org/classes/ActionController/Filters/ClassMethods.html#M000526">before_filter</a>
method as filter options and this lets you state conditions for which “<a
href="ClassMethods.html#method-i-uses_yui_tree">#uses_yui_tree</a>” applies
(e.g. “<code>:only =&gt; ...</code>” for only certain actions or
“<code>:except =&gt; ...</code>” for all actions except those listed). See
the Rails <a
href="http://api.rubyonrails.org/classes/ActionController/Filters/ClassMethods.html">filter API documentation</a>
for full details.</p>

<p>Most options for YUI trees can be specified in any of three places:</p>
<ol><li>
<p>In the YAML configuration file.</p>
</li><li>
<p>In a call to “<a
href="ClassMethods.html#method-i-uses_yui_tree">#uses_yui_tree</a>” from a
controller.</p>
</li><li>
<p>In a call to the “<a
href="YuiTreeHelper.html#method-i-yui_tree">YuiTree::YuiTreeHelper#yui_tree</a>”
helper method from a view.</p>
</li></ol>

<p>Options in the YAML file are application-global and overriden by those
specified in a controller, which are controller-global and in turn
overriden by local options given to helper method calls in views.</p>

<p>Some options only make sense if specified in the YAML configuration file
and so cannot be specified elsewhere. When installed the plugin writes a
default configuration file in “config/yui_tree.yml”; see this for further
information on the option meainings:</p>
<ul><li>
<p><code>:version</code></p>
</li><li>
<p><code>:javascript_base_uri</code></p>
</li><li>
<p><code>:additional_yui_javascripts</code> (an optional item)</p>
</li></ul>

<p>The following options usually only make sense if given in the YAML
configuration file and have default values written there, but they can be
specified per-controller or in each helper call in views if you really want
to do that:</p>
<ul><li>
<p><code>:xhr_timeout</code></p>
</li><li>
<p><code>:div_class</code> (the class assigned to any DIV into which a YUI
tree is built)</p>
</li></ul>

<p>These options can appear in the YAML file or here only, but not in helper
calls for individual views:</p>
<ul><li>
<p><code>:body_class</code> (a class name added to any existing class name(s)
on the BODY element of the HTML document) - if "<code>yui-skin-sam</code>"
is used then CSS files for this skin will be included automatically, else
you must manually ensure that all relevant CSS resources are included.</p>
</li></ul>

<p>Other options must be specified in calls to “<a
href="ClassMethods.html#method-i-uses_yui_tree">#uses_yui_tree</a>”, or to
a helper function like “<a
href="YuiTreeHelper.html#method-i-yui_tree">YuiTree::YuiTreeHelper#yui_tree</a>”
as they have no default values. You could put them into the YAML file but
due to the nature of the options it is very likely that you’ll specify them
in method calls instead. In fact it’s more likely that you will want to
specify them in calls made in views rather than here in “<a
href="ClassMethods.html#method-i-uses_yui_tree">#uses_yui_tree</a>”, but
you can establish Controller-global defaults by specifying the options here
if you find this useful.</p>
<dl class="rdoc-list note-list"><dt><code>:root_model</code>
<dd>
<p>If your model supports tree/nested-set like behaviour - for example, if
your model declares “<code>acts_as_nested_set</code>” via the <a
href="http://github.com/collectiveidea/awesome_nested_set/">Awesome Nested Set</a>
plugin - then specify the root model class here (e.g specify
“<code>:root_model =&gt; Location</code>” or “<code>:root_model =&gt;
Category</code>”) as a Controller-global default. Nested set behaviour
assumes a class method called “roots” which takes no parameters and returns
an array of model instances which are tree roots; and an instance method
“leaf?” which also takes no parameters and returns ‘<code>true</code>’ if
the instance has no children (is a leaf node), else returns
‘<code>false</code>’.</p>

<p>The root model is used by YUI tree creation code (e.g. see helper method
“<a
href="YuiTreeHelper.html#method-i-yui_tree">YuiTree::YuiTreeHelper#yui_tree</a>”)
to generate the root data set for the initial tree view. Alternatively,
specify this when you make the call to e.g. “<a
href="YuiTreeHelper.html#method-i-yui_tree">YuiTree::YuiTreeHelper#yui_tree</a>”
if you don’t want to set a default here. By default the helper code calls
an instance method called “name” to obtain label text for the tree nodes.
Use the “<code>:root_title_method</code>” option (see below) to specify a
different method name if necessary.</p>

<p>The root and child items can be sorted in various ways. See method
“yui_tree_handled_xhr_request?” method for further information.</p>

<p>If you want to supply the collection of root objects yourself, rather than
using a “<code>:root_model</code>” (see above) and its “roots” class
method, you can do so when building the tree in a view through a call to
the “<a
href="YuiTreeHelper.html#method-i-yui_tree">YuiTree::YuiTreeHelper#yui_tree</a>”
helper method. See its “<code>:root_collection</code>” option for details.
Whenever you need to assemble an array of objects to be used as roots or
children, you must always build those objects with the “<a
href="../YuiTree.html#method-c-make_node_object">YuiTree.make_node_object</a>”
method.</p>
</dd><dt><code>:root_title_method</code>
<dd>
<p>If using “<code>:root_model</code>” (see above) but with a model which uses
something other than a “name” method to return text for showing in tree
nodes, then specify the alternative method’s name here as a symbol. It must
be an instance method for the model in question and should return a
non-empty string.</p>
</dd><dt><code>:xhr_url_method</code>
<dd>
<p>Name of a method which will be invoked to get the <strong>prefix</strong>
of a URL used to fetch more tree data (when parent nodes are expanded for
the first time). This is usually a path to a controller’s ‘index’ action,
e.g. “<code>:locations_path</code>” or “<code>:categories_path</code>”. The
corresponding Controller action must return an array of child data. It can
use the “yui_tree_handled_xhr_request?” method to do this or use entirely
custom code. It must return an array of child data as described above (see
“<code>:root_model</code>”), generating array entries with the “<a
href="../YuiTree.html#method-c-make_node_object">YuiTree.make_node_object</a>”
method. The parent’s database ID is delivered to the controller action via
the “params” hash under key “<code>:tree_parent_id</code>” and may have a
string, symbol or integer value type.</p>
</dd></dl>

<p>Some options are likely to be set per-tree but do have default values:</p>
<dl class="rdoc-list note-list"><dt><code>:select_leaf_only</code>
<dd>
<p>Set to ‘<code>true</code>’ if leaves (nodes without children) can be
selected but parents cannot, else ‘<code>false</code>’. Has an internal
default value of ‘<code>false</code>’ (i.e. can select anything).</p>
</dd></dl>

<p>A few YUI tree options can be set as global defaults when making calls to
“<a href="ClassMethods.html#method-i-uses_yui_tree">#uses_yui_tree</a>”,
but such defaults only make sense if you use a single tree in any of the
containing controller’s views. For example, the option giving the ID of
enclosing DIV inside which the tree is built falls into this category,
since no two elements in a valid HTML document are allowed to have the same
ID. It is up to you where you choose to specify these options - here, or
individual calls to “<a
href="YuiTreeHelper.html#method-i-yui_tree">YuiTree::YuiTreeHelper#yui_tree</a>”.</p>
<dl class="rdoc-list note-list"><dt><code>:div_id</code>
<dd>
<p>ID given to the DIV container into which trees are built. Only specify this
as a controller-global default if you are only going to use one tree
control in any given view, else more than one DIV container for more than
one tree view would have the same ID; or make very sure that any views
using more than one tree view specify overriding DIV IDs in those views’
calls to “<a
href="YuiTreeHelper.html#method-i-yui_tree">YuiTree::YuiTreeHelper#yui_tree</a>”.</p>
</dd><dt><code>:div_class</code>
<dd>
<p>As “<code>:div_id</code>”, but even less frequently used! Usually you will
want application-wide styles to apply to trees via CSS and thus specify a
single application-global class name in the YUI tree plugin’s YAML
configuration file, rather than specifying a controller-global value here,
or even a per-tree value in indivdual calls to “<a
href="YuiTreeHelper.html#method-i-yui_tree">YuiTree::YuiTreeHelper#yui_tree</a>”.
Nonetheless, the facility exists to use any of those three approaches
should they prove useful to you.</p>
</dd><dt><code>:target_form_field_id</code>
<dd>
<p>Whenever a node is selected, its database ID is written as a value of the
“<code>value</code>” (sic.) attribute of the HTML element identified by
this option so that a related form submission will contain the selected ID.
The field is usually a hidden INPUT element.</p>

<p>Although the tree has a multiple selection mode (see the documentation for
“<a
href="YuiTreeHelper.html#method-i-yui_tree">YuiTree::YuiTreeHelper#yui_tree</a>”
for details), by default it assumes that you always want to ultimately let
the user select a single item in the tree and have that item’s database ID
passed back to a controller in a related form submission.</p>

<p>A value of 0 may indicate that a blank entry is use and has been selected.
See option “<code>:include_blank</code>” in helper method “<a
href="YuiTreeHelper.html#method-i-yui_tree">YuiTree::YuiTreeHelper#yui_tree</a>”.</p>

<p>An empty string indicates that no nodes were highlighted at all. If you
allow such things you should probably interpret this the same as the user
explicitly selecting a blank entry. It’s good to allow both as it isn’t too
friendly to assume the user will mean that deselecting all nodes means
“none/blank”; it’s good to have an explicit entry for that. You can still
fault a no-selection form submission from the controller if the target form
field value is empty rather than zero, should you wish to do so.</p>
</dd><dt><code>:target_name_field_id</code>
<dd>
<p>Optional; if included, then when a node is selected, its display text is
written as innerHTML inside the identified element. This lets you show the
user which node was selected by its text, as well as by the TreeView’s own
highlight mechanism. This is handy if you’re worried that a selected node
in a collapsed branch remains selected, albeit invisibly - a TreeView
implementation quirk, it seems.</p>

<p>If you specify a value for the “<code>:include_blank</code>” option in a
call to helper method “<a
href="YuiTreeHelper.html#method-i-yui_tree">YuiTree::YuiTreeHelper#yui_tree</a>”,
then note that the specified string will be written into the name field if
either a “blank” tree entry item is explicitly selected, or if all items in
the tree are entirely deselected. This goes back to the idea in
“<code>:target_form_field_id</code>” above of a zero ID value, or a blank
ID value, being usually treated as the same thing; but again, the
controller can always treat the two conditions as distinct from one another
if it so wishes.</p>
</dd></dl>

<h2 id="method-i-uses_yui_tree-label-Example">Example</h2>

<pre class="ruby"><span class="ruby-comment"># Location model &quot;acts_as_nested_set&quot;; uses Awesome Nested Set plugin;</span>
<span class="ruby-comment"># thus has &quot;roots&quot; and &quot;leaf?&quot; methods which act as expected. Location</span>
<span class="ruby-comment"># objects have a displayable name property in &quot;name&quot;.</span>

<span class="ruby-identifier">uses_yui_tree</span>(
  { :<span class="ruby-identifier">root_model</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Location</span>, :<span class="ruby-identifier">xhr_url_method</span> =<span class="ruby-operator">&gt;</span> :<span class="ruby-identifier">locations_path</span> },
  { :<span class="ruby-identifier">only</span> =<span class="ruby-operator">&gt;</span> [ :<span class="ruby-identifier">edit</span>, :<span class="ruby-identifier">update</span> ] }
)
</pre>

<p>This prepares the Controller for a YUI tree using a “Location” model. The
tree will obtain new data by a JSON XHR request to the URL returned by a
call to “locations_path” with “.js” added as a suffix. Only the “:edit” and
“:update” actions can use the tree. Listing both of these actions in the
“:only” clause is vital since the Controller’s “update” code might
re-render the “edit” view (and thus the tree) because of form validation
errors. Alternatively use “:exclude” rather than “:only”, or omit such a
clause altogether to prepare all the controller’s views for YUI trees.</p>

<p>An XHR URL method of “locations_path” will (assuming sane routes!) lead to
an “index” action of a controller for the Location model. The index method
must be aware of the YUI tree JSON requests - see
“yui_tree_handled_xhr_request?” or use the usual Rails “<code>respond_to do
|format| ... format.js do ...</code>” construct.</p>

<pre class="ruby"><span class="ruby-keyword">def</span> <span class="ruby-identifier">index</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">yui_tree_handled_xhr_request?</span>( <span class="ruby-constant">Location</span> );
  <span class="ruby-comment"># ...other processing code...</span>
<span class="ruby-keyword">end</span>
</pre>

<p>A helper method such as “<a
href="YuiTreeHelper.html#method-i-yui_tree">YuiTree::YuiTreeHelper#yui_tree</a>”
must be invoked somewhere in the “:edit” action’s view (e.g. in
“edit.html.erb”) so that the tree actually gets built:</p>

<pre>&lt;%= hidden_field_tag( 'foo', '[currently selected item ID here]' ) %&gt;
&lt;%= yui_tree( :target_form_field_id =&gt; 'foo' ) %&gt;</pre>
          

          
          <div class="method-source-code" id="uses_yui_tree-source">
            <pre><span class="ruby-comment"># File lib/yui_tree/yui_tree.rb, line 247</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">uses_yui_tree</span>( <span class="ruby-identifier">tree_options</span> = {}, <span class="ruby-identifier">filter_options</span> = {} )
  <span class="ruby-identifier">proc</span> = <span class="ruby-constant">Proc</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">c</span> <span class="ruby-operator">|</span>
    <span class="ruby-identifier">c</span>.<span class="ruby-identifier">instance_variable_set</span>( <span class="ruby-value">:@yui_tree_options</span>, <span class="ruby-identifier">tree_options</span> )
    <span class="ruby-identifier">c</span>.<span class="ruby-identifier">instance_variable_set</span>( <span class="ruby-value">:@uses_yui_tree</span>,    <span class="ruby-keyword">true</span>         )
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">before_filter</span>( <span class="ruby-identifier">proc</span>, <span class="ruby-identifier">filter_options</span> )

  <span class="ruby-comment"># See the dummy, static version of &quot;yui_tree_handled_xhr_request?&quot; below</span>
  <span class="ruby-comment"># for documentation.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class_eval</span> <span class="ruby-node">%Q(
    define_method( :yui_tree_handled_xhr_request? ) do | model, *optional |
      result = false

      # WARNING: By default Rails treats XHR requests as &quot;.js&quot; format, if
      # no other format indication (e.g. filename extension, very specific
      # HTTP Accept header) exists. As a result this code can be run for
      # other XHR requests coming into your controller even though you
      # think it ought not to be. Hence the &quot;params.has_key?&quot; check, to try
      # and guard against accidental execution.

      if ( request.xhr? &amp;&amp; params.has_key?( :tree_parent_id ) )
        respond_to do | format |
          format.js do

            # Use find_by_id() rather than just find() to avoid an exception if
            # the item cannot be located.

            parent = model.find_by_id( params[ :tree_parent_id ] )

            if ( parent.nil? )
              render :json =&gt; []
            else
              children = parent.children()

              if ( model.respond_to?( :apply_default_sort_order ) )
                model.apply_default_sort_order( children )
              end

              children.map!() do | child |
                YuiTree::make_node_object(
                  child.id,
                  child.send( optional[ 0 ] || YuiTree::YUI_TREE_DEFAULT_TITLE_METHOD ),
                  child.send( optional[ 1 ] || :leaf? )
                )
              end

              render :json =&gt; children
            end

            result = true

          end # format.js do
        end   # respond_to do | format |
      end     # if ( request.xhr? ... )

      result # Can't do &quot;return result&quot;; leads to ThreadError exception.

    end # define_method...
  )</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- uses_yui_tree-source -->
          
        </div>

        

        
      </div><!-- uses_yui_tree-method -->

    
      <div id="method-i-yui_tree_handled_xhr_request-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">yui_tree_handled_xhr_request?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>When the tree calls back via AJAX and needs some children to fill in a tree
branch, call here to return appropriate data. Pass in the model to find
from (e.g. Category, Location - a class, not a string or symbol), then
optionally the name of the model instance method used to obtain the text to
show for each node (default is “name”) and the name of a method used to
find out if the item is a leaf (default is “leaf?”) - it should return
‘true’ if so, else ‘false’. Models which “act_as_nested_set” using the <a
href="http://github.com/collectiveidea/awesome_nested_set/tree/master">Awesome Nested Set</a>
plug-in are compatible with the defaults.</p>

<p>If you want the tree order items automatically sorted then add a class
method called “apply_default_sort_order” to your model. This is passed an
array of model object instances and should sort the array in-place (e.g.
with the Array “sort!” method). The method’s return value is ignored. If
the model has no “apply_default_sort_order” method then the collection
retrieved from the database is left in default sort order. If you have
simple requirements then using a call to Rails’ “<a
href="http://api.rubyonrails.org/classes/ActiveRecord/Base.html#M002313">default_scope</a>”
method from your model is the most efficient way to achieve sorted results.
For example, in your model issue:</p>

<pre class="ruby"><span class="ruby-identifier">default_scope</span>( { :<span class="ruby-identifier">order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'name DESC'</span> } )
</pre>

<p>…to have all collections of that model returned by finder methods sorted in
descending order by a “name” field by default. This applies to <em>all</em>
finds done by your application, not just those related to YUI trees, so use
the “apply_default_sort_order” approach to restrict the ordering to YUI
tree views only.</p>

<h2 id="method-i-yui_tree_handled_xhr_request-3F-label-Example">Example</h2>

<p>A controller example inside an action which gets invoked when the XHR
request comes in:</p>

<pre class="ruby"><span class="ruby-keyword">def</span> <span class="ruby-identifier">action_name</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">yui_tree_handled_xhr_request?</span>( <span class="ruby-constant">Location</span>, :<span class="ruby-identifier">title</span>, :<span class="ruby-identifier">isLeaf?</span> )
  <span class="ruby-comment"># ...rest of normal action code...</span>
<span class="ruby-keyword">end</span>
</pre>

<p>This would handle YUI tree requests for a Location model using method
“title” (rather than the default of “name”) to obtain the human-readable
names of locations and method “isLeaf?” (rather than the default of
“leaf?”) to determine whether or not the item is at the end of a branch.</p>
          

          
          <div class="method-source-code" id="yui_tree_handled_xhr_request-3F-source">
            <pre><span class="ruby-comment"># File lib/yui_tree/yui_tree.rb, line 354</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">yui_tree_handled_xhr_request?</span>
  <span class="ruby-comment"># This method is generated dynamically at run-time, the dynamic version</span>
  <span class="ruby-comment"># overwriting this one. The method here exists purely so that the RDoc</span>
  <span class="ruby-comment"># documentation generator will create documentation for the method.</span>
  <span class="ruby-comment"># Please see the implementation of &quot;uses_yui_tree&quot; above to see the code</span>
  <span class="ruby-comment"># for the dynamically generated method.</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- yui_tree_handled_xhr_request-3F-source -->
          
        </div>

        

        
      </div><!-- yui_tree_handled_xhr_request-3F-method -->

    
    </section><!-- public-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.12.2.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

