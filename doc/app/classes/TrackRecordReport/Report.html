<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: TrackRecordReport::Report</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">TrackRecordReport::Report</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../files/lib/track_record_report_rb.html">
                lib/track_record_report.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="ReportElementaryCalculator.html">
                ReportElementaryCalculator
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
Class which manages a report.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000211">active_task_ids=</a>&nbsp;&nbsp;
      <a href="#M000207">active_tasks</a>&nbsp;&nbsp;
      <a href="#M000221">column_heading</a>&nbsp;&nbsp;
      <a href="#M000220">column_title</a>&nbsp;&nbsp;
      <a href="#M000215">compile</a>&nbsp;&nbsp;
      <a href="#M000217">display_range</a>&nbsp;&nbsp;
      <a href="#M000214">frequency=</a>&nbsp;&nbsp;
      <a href="#M000212">inactive_task_ids=</a>&nbsp;&nbsp;
      <a href="#M000208">inactive_tasks</a>&nbsp;&nbsp;
      <a href="#M000218">label</a>&nbsp;&nbsp;
      <a href="#M000216">label</a>&nbsp;&nbsp;
      <a href="#M000219">labels</a>&nbsp;&nbsp;
      <a href="#M000206">new</a>&nbsp;&nbsp;
      <a href="#M000222">partial_column?</a>&nbsp;&nbsp;
      <a href="#M000210">task_ids=</a>&nbsp;&nbsp;
      <a href="#M000209">tasks=</a>&nbsp;&nbsp;
      <a href="#M000213">user_ids=</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->
    <div id="includes">
      <h3 class="section-bar">Included Modules</h3>

      <div id="includes-list">
        <span class="include-name"><a href="../TrackRecordSections.html">TrackRecordSections</a></span>
      </div>
    </div>

    <div id="section">


    <div id="constants-list">
      <h3 class="section-bar">Constants</h3>

      <div class="name-list">
        <table summary="Constants">
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">FREQUENCY</td>
          <td>=</td>
          <td class="context-item-value">[       { :label =&gt; 'Totals only',      :title =&gt; '',                  :column =&gt; :heading_total,             :generator =&gt; :totals_report                                          },       { :label =&gt; 'UK tax year',      :title =&gt; 'UK tax year:',      :column =&gt; :heading_tax_year,          :generator =&gt; :periodic_report, :generator_arg =&gt; :end_of_uk_tax_year },       { :label =&gt; 'Calendar year',    :title =&gt; 'Year:',             :column =&gt; :heading_calendar_year,     :generator =&gt; :periodic_report, :generator_arg =&gt; :end_of_year        },       { :label =&gt; 'Calendar quarter', :title =&gt; 'Quarter starting:', :column =&gt; :heading_quarter_and_month, :generator =&gt; :periodic_report, :generator_arg =&gt; :end_of_quarter     },       { :label =&gt; 'Monthly',          :title =&gt; 'Month:',            :column =&gt; :heading_quarter_and_month, :generator =&gt; :periodic_report, :generator_arg =&gt; :end_of_month       },       { :label =&gt; 'Weekly',           :title =&gt; 'Week starting:',    :column =&gt; :heading_weekly,            :generator =&gt; :periodic_report, :generator_arg =&gt; :end_of_week        },        # Daily reports are harmful since they can cause EXTREMELY large reports       # to be generated and this can take longer than the web browser will wait       # before timing out. In the mean time, Rails keeps building the report...       #       # { :label =&gt; 'Daily',            :title =&gt; 'Date:',              :column =&gt; :heading_daily,            :generator =&gt; :daily_report                                           },     ]</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
Configure the handlers and human-readable <a
href="Report.html#M000219">labels</a> for the ways in which reports get
broken up, in terms of frequency. View code which presents a choice of
report frequency should obtain the <a href="Report.html#M000219">labels</a>
for the list with the &#8216;<a href="Report.html#M000216">label</a>&#8217;
method. Use the &#8216;<a
href="Report.html#M000220">column_title</a>&#8217; method for a column
&quot;title&quot;, shown alongside or above column headings. Use the
&#8216;<a href="Report.html#M000221">column_heading</a>&#8217; method for
per-column headings.

</td>
        </tr>
        </table>
      </div>
    </div>



    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">active_task_ids</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">column_count</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
Number of columns after all calculations are complete; this is the same as
the size of the &#8216;column_ranges&#8217; or &#8216;column_totals&#8217;
arrays below, but using this explicit property is likely to make code more
legible.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">column_ranges</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
Array of ranges, one per column, giving the range for each of the columns
held within the rows. The indices into this array match indices into the
rows&#8217; cell arrays.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">column_totals</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
Array of <a href="ReportColumnTotal.html">ReportColumnTotal</a> objects,
one per column, giving the total hours for that column. The indices into
this array match indices into the rows&#8217; cell arrays.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">customer_sort_field</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
Sort fields for customers, projects and tasks; grouping options.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">filtered_tasks</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">filtered_users</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">frequency</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
A row from the FREQUENCY constant and the current index into that array, as
a stringify_keys.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">frequency_data</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
A row from the FREQUENCY constant and the current index into that array, as
a stringify_keys.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">inactive_task_ids</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">project_sort_field</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
Sort fields for customers, projects and tasks; grouping options.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">range</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
Complete date range for the whole report; array of user IDs used for
per-user breakdowns; array of task IDs the report will represent.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">range_end</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
Range data for the &#8216;<a href="Report.html#M000206">new</a>&#8217; view
form.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">range_month_end</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">range_month_start</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">range_start</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
Range data for the &#8216;<a href="Report.html#M000206">new</a>&#8217; view
form.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">range_week_end</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">range_week_start</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">rows</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
Array of ReportRows making up the report. The row objects contain arrays of
cells, corresponding to columns of the report.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">sections</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
Array of <a href="ReportSection.html">ReportSection</a> objects describing
per-section totals of various kinds. See the <a
href="ReportSection.html">ReportSection</a> class and <a
href="../TrackRecordSections.html">TrackRecordSections</a> module for
details.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">task_filter</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
Handle all (&quot;all&quot;), only billable (&quot;billable&quot;) or only
non-billable (&quot;non_billable&quot;) tasks?

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">task_grouping</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">task_ids</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">task_sort_field</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
Sort fields for customers, projects and tasks; grouping options.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">tasks</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
Read-only array of actual user and task objects based on the IDs; call
&quot;build_task_and_user_arrays&quot; to build it. Not all users or tasks
may be included, depending on security settings.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">total_actual_remaining</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
Total duration of all tasks in all rows; number of hours remaining (may be
negative for overrun) after all hours worked in tasks with non-zero
duration. If &#8216;nil&#8217;, <b>all</b> tasks had zero duration. The
&#8216;actual&#8217; value only accounts for committed hours, while the
&#8216;potential&#8217; value includes both committed and not-committed
hours (thus, subject to change).

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">total_duration</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
Total duration of all tasks in all rows; number of hours remaining (may be
negative for overrun) after all hours worked in tasks with non-zero
duration. If &#8216;nil&#8217;, <b>all</b> tasks had zero duration. The
&#8216;actual&#8217; value only accounts for committed hours, while the
&#8216;potential&#8217; value includes both committed and not-committed
hours (thus, subject to change).

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">total_potential_remaining</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
Total duration of all tasks in all rows; number of hours remaining (may be
negative for overrun) after all hours worked in tasks with non-zero
duration. If &#8216;nil&#8217;, <b>all</b> tasks had zero duration. The
&#8216;actual&#8217; value only accounts for committed hours, while the
&#8216;potential&#8217; value includes both committed and not-committed
hours (thus, subject to change).

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">user_column_totals</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
Array of <a href="ReportUserColumnTotal.html">ReportUserColumnTotal</a>
objects, each index corresponding to a user the &quot;users&quot; array at
the same index. These give the total work done by that user across all
rows.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">user_ids</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">users</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
Read-only array of actual user and task objects based on the IDs; call
&quot;build_task_and_user_arrays&quot; to build it. Not all users or tasks
may be included, depending on security settings.

</td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000218" class="method-detail">
        <a name="M000218"></a>

        <div class="method-heading">
          <a href="#M000218" class="method-signature">
          <span class="method-name">label</span><span class="method-args">( frequency )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Class method equivalent of &quot;<a
href="Report.html#M000216">label</a>&quot; above. Returns the <a
href="Report.html#M000216">label</a> for the given frequency, which must be
a valid index into Report::FREQUENCY. See also &quot;<a
href="Report.html#M000219">labels</a>&quot; below.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000218-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000218-source">
<pre>
     <span class="ruby-comment cmt"># File lib/track_record_report.rb, line 331</span>
331:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">label</span>( <span class="ruby-identifier">frequency</span> )
332:       <span class="ruby-keyword kw">return</span> <span class="ruby-constant">Report</span><span class="ruby-operator">::</span><span class="ruby-constant">FREQUENCY</span>[ <span class="ruby-identifier">frequency</span> ][ <span class="ruby-identifier">:label</span> ]
333:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000219" class="method-detail">
        <a name="M000219"></a>

        <div class="method-heading">
          <a href="#M000219" class="method-signature">
          <span class="method-name">labels</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Class method which returns an array of <a
href="Report.html#M000219">labels</a> for various report frequencies. The
index into the array indicates the frequency index.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000219-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000219-source">
<pre>
     <span class="ruby-comment cmt"># File lib/track_record_report.rb, line 338</span>
338:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">labels</span>
339:       <span class="ruby-keyword kw">return</span> <span class="ruby-constant">Report</span><span class="ruby-operator">::</span><span class="ruby-constant">FREQUENCY</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span> <span class="ruby-identifier">f</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>[ <span class="ruby-identifier">:label</span> ] }
340:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000206" class="method-detail">
        <a name="M000206"></a>

        <div class="method-heading">
          <a href="#M000206" class="method-signature">
          <span class="method-name">new</span><span class="method-args">( current_user, params = nil )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Create a <a href="Report.html#M000206">new</a> <a
href="Report.html">Report</a>. In the first parameter, pass the current
TrackRecord user. In the next parameter pass nothing to use default values
for a &#8216;<a href="Report.html#M000206">new</a> report&#8217; view form,
or pass &quot;params[ :report ]&quot; (or similar) to create using a params
hash from a &#8216;<a href="Report.html#M000206">new</a> report&#8217; form
submission.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000206-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000206-source">
<pre>
     <span class="ruby-comment cmt"># File lib/track_record_report.rb, line 178</span>
178:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>( <span class="ruby-identifier">current_user</span>, <span class="ruby-identifier">params</span> = <span class="ruby-keyword kw">nil</span> )
179:       <span class="ruby-ivar">@current_user</span> = <span class="ruby-identifier">current_user</span>
180: 
181:       <span class="ruby-ivar">@range_start</span>           = <span class="ruby-keyword kw">nil</span>
182:       <span class="ruby-ivar">@range_end</span>             = <span class="ruby-keyword kw">nil</span>
183:       <span class="ruby-ivar">@range_week_start</span>      = <span class="ruby-keyword kw">nil</span>
184:       <span class="ruby-ivar">@range_week_end</span>        = <span class="ruby-keyword kw">nil</span>
185:       <span class="ruby-ivar">@range_month_start</span>     = <span class="ruby-keyword kw">nil</span>
186:       <span class="ruby-ivar">@range_month_end</span>       = <span class="ruby-keyword kw">nil</span>
187:       <span class="ruby-ivar">@frequency</span>             = <span class="ruby-value">0</span>
188: 
189:       <span class="ruby-ivar">@customer_sort_field</span>   = <span class="ruby-value str">'title'</span>
190:       <span class="ruby-ivar">@project_sort_field</span>    = <span class="ruby-value str">'title'</span>
191:       <span class="ruby-ivar">@task_sort_field</span>       = <span class="ruby-constant">Task</span><span class="ruby-operator">::</span><span class="ruby-constant">DEFAULT_SORT_COLUMN</span>
192:       <span class="ruby-ivar">@task_grouping</span>         = <span class="ruby-identifier">:default</span>
193:       <span class="ruby-ivar">@task_filter</span>           = <span class="ruby-value str">'all'</span>
194: 
195:       <span class="ruby-ivar">@include_totals</span>        = <span class="ruby-keyword kw">true</span>
196:       <span class="ruby-ivar">@include_committed</span>     = <span class="ruby-keyword kw">false</span>
197:       <span class="ruby-ivar">@include_not_committed</span> = <span class="ruby-keyword kw">false</span>
198:       <span class="ruby-ivar">@exclude_zero_rows</span>     = <span class="ruby-keyword kw">false</span>
199:       <span class="ruby-ivar">@exclude_zero_cols</span>     = <span class="ruby-keyword kw">false</span> <span class="ruby-comment cmt"># Totals only - ignores zero com/non-com columns in CSV exports for total/com/non-com column groups with non-zero totals</span>
200: 
201:       <span class="ruby-ivar">@tasks</span>                 = []
202:       <span class="ruby-ivar">@filtered_tasks</span>        = []
203:       <span class="ruby-ivar">@task_ids</span>              = []
204:       <span class="ruby-ivar">@active_task_ids</span>       = []
205:       <span class="ruby-ivar">@inactive_task_ids</span>     = []
206: 
207:       <span class="ruby-ivar">@users</span>                 = []
208:       <span class="ruby-ivar">@filtered_users</span>        = []
209:       <span class="ruby-ivar">@user_ids</span>              = []
210: 
211:       <span class="ruby-keyword kw">unless</span> ( <span class="ruby-identifier">params</span>.<span class="ruby-identifier">nil?</span> )
212: 
213:         <span class="ruby-comment cmt"># Adapted from ActiveRecord::Base &quot;attributes=&quot;, Rails 2.1.0</span>
214:         <span class="ruby-comment cmt"># on 29-Jun-2008.</span>
215: 
216:         <span class="ruby-identifier">attributes</span> = <span class="ruby-identifier">params</span>.<span class="ruby-identifier">dup</span>
217:         <span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">stringify_keys!</span>
218:         <span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span> <span class="ruby-operator">|</span>
219:           <span class="ruby-keyword kw">if</span> ( <span class="ruby-identifier">key</span>.<span class="ruby-identifier">include?</span>( <span class="ruby-value str">'('</span> ) )
220:             <span class="ruby-identifier">raise</span>( <span class="ruby-value str">&quot;Multi-parameter attributes are not supported.&quot;</span> )
221:           <span class="ruby-keyword kw">else</span>
222:             <span class="ruby-identifier">send</span>( <span class="ruby-identifier">key</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;=&quot;</span>, <span class="ruby-identifier">value</span> )
223:           <span class="ruby-keyword kw">end</span>
224:         <span class="ruby-keyword kw">end</span>
225:       <span class="ruby-keyword kw">end</span>
226:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000211" class="method-detail">
        <a name="M000211"></a>

        <div class="method-heading">
          <a href="#M000211" class="method-signature">
          <span class="method-name">active_task_ids=</span><span class="method-args">( ids )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Build the &#8216;tasks&#8217; array if &#8216;active_task_ids&#8217; is
updated externally. The result will be the sum of existing inactive and
updated active task IDs.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000211-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000211-source">
<pre>
     <span class="ruby-comment cmt"># File lib/track_record_report.rb, line 260</span>
260:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">active_task_ids=</span>( <span class="ruby-identifier">ids</span> )
261:       <span class="ruby-ivar">@active_task_ids</span> = <span class="ruby-identifier">map_raw_ids</span>( <span class="ruby-identifier">ids</span> )
262:       <span class="ruby-identifier">assign_tasks_from_ids</span>( <span class="ruby-ivar">@active_task_ids</span>, <span class="ruby-ivar">@inactive_task_ids</span> )
263:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000207" class="method-detail">
        <a name="M000207"></a>

        <div class="method-heading">
          <a href="#M000207" class="method-signature">
          <span class="method-name">active_tasks</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Virtual accessor for the active task list, which just filters the master
task list and returns the result (less RAM than keeping dual lists and not
speed-critical as not used that often in practice).
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000207-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000207-source">
<pre>
     <span class="ruby-comment cmt"># File lib/track_record_report.rb, line 232</span>
232:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">active_tasks</span>
233:       <span class="ruby-ivar">@tasks</span>.<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span> <span class="ruby-identifier">task</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">task</span>.<span class="ruby-identifier">active</span> }
234:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000221" class="method-detail">
        <a name="M000221"></a>

        <div class="method-heading">
          <a href="#M000221" class="method-signature">
          <span class="method-name">column_heading</span><span class="method-args">( col_index )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Helper method which returns a user-displayable column heading appropriate
for the report type. Pass the column index.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000221-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000221-source">
<pre>
     <span class="ruby-comment cmt"># File lib/track_record_report.rb, line 353</span>
353:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">column_heading</span>( <span class="ruby-identifier">col_index</span> )
354:       <span class="ruby-identifier">col_range</span> = <span class="ruby-ivar">@column_ranges</span>[ <span class="ruby-identifier">col_index</span> ]
355:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">send</span>( <span class="ruby-ivar">@frequency_data</span>[ <span class="ruby-identifier">:column</span> ], <span class="ruby-identifier">col_range</span> )
356:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000220" class="method-detail">
        <a name="M000220"></a>

        <div class="method-heading">
          <a href="#M000220" class="method-signature">
          <span class="method-name">column_title</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Helper method which returns a user-displayable column title to be shown
once, next to or near per-column headings (see &quot;<a
href="Report.html#M000221">column_heading</a>&quot;), appropriate for the
report type.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000220-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000220-source">
<pre>
     <span class="ruby-comment cmt"># File lib/track_record_report.rb, line 346</span>
346:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">column_title</span>
347:       <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@frequency_data</span>[ <span class="ruby-identifier">:title</span> ]
348:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000215" class="method-detail">
        <a name="M000215"></a>

        <div class="method-heading">
          <a href="#M000215" class="method-signature">
          <span class="method-name">compile</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Compile the report.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000215-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000215-source">
<pre>
     <span class="ruby-comment cmt"># File lib/track_record_report.rb, line 301</span>
301:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">compile</span>
302:       <span class="ruby-identifier">rationalise_dates</span>()
303:       <span class="ruby-identifier">apply_filters</span>()
304:       <span class="ruby-identifier">sort_and_group</span>()
305: 
306:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> ( <span class="ruby-ivar">@filtered_tasks</span>.<span class="ruby-identifier">empty?</span> )
307: 
308:       <span class="ruby-identifier">add_rows</span>()
309:       <span class="ruby-identifier">add_columns</span>()
310:       <span class="ruby-identifier">calculate!</span>()
311:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000217" class="method-detail">
        <a name="M000217"></a>

        <div class="method-heading">
          <a href="#M000217" class="method-signature">
          <span class="method-name">display_range</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Helper method which returns a user-displayable range describing the total
date range for this report.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000217-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000217-source">
<pre>
     <span class="ruby-comment cmt"># File lib/track_record_report.rb, line 323</span>
323:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">display_range</span>
324:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">heading_total</span>( <span class="ruby-ivar">@range</span> )
325:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000214" class="method-detail">
        <a name="M000214"></a>

        <div class="method-heading">
          <a href="#M000214" class="method-signature">
          <span class="method-name">frequency=</span><span class="method-args">( freq )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Set the &#8216;frequency_data&#8217; field when &#8216;frequency&#8217; is
updated externally.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000214-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000214-source">
<pre>
     <span class="ruby-comment cmt"># File lib/track_record_report.rb, line 294</span>
294:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">frequency=</span>( <span class="ruby-identifier">freq</span> )
295:       <span class="ruby-ivar">@frequency</span>      = <span class="ruby-identifier">freq</span>.<span class="ruby-identifier">to_i</span>
296:       <span class="ruby-ivar">@frequency_data</span> = <span class="ruby-constant">FREQUENCY</span>[ <span class="ruby-ivar">@frequency</span> ]
297:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000212" class="method-detail">
        <a name="M000212"></a>

        <div class="method-heading">
          <a href="#M000212" class="method-signature">
          <span class="method-name">inactive_task_ids=</span><span class="method-args">( ids )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Build the &#8216;tasks&#8217; array if &#8216;inactive_task_ids&#8217; is
updated externally. The result will be the sum of existing active and
updated inactive task IDs.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000212-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000212-source">
<pre>
     <span class="ruby-comment cmt"># File lib/track_record_report.rb, line 268</span>
268:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">inactive_task_ids=</span>( <span class="ruby-identifier">ids</span> )
269:       <span class="ruby-ivar">@inactive_task_ids</span> = <span class="ruby-identifier">map_raw_ids</span>( <span class="ruby-identifier">ids</span> )
270:       <span class="ruby-identifier">assign_tasks_from_ids</span>( <span class="ruby-ivar">@active_task_ids</span>, <span class="ruby-ivar">@inactive_task_ids</span> )
271:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000208" class="method-detail">
        <a name="M000208"></a>

        <div class="method-heading">
          <a href="#M000208" class="method-signature">
          <span class="method-name">inactive_tasks</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
As above, but for inactive tasks.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000208-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000208-source">
<pre>
     <span class="ruby-comment cmt"># File lib/track_record_report.rb, line 238</span>
238:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">inactive_tasks</span>
239:       <span class="ruby-ivar">@tasks</span>.<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span> <span class="ruby-identifier">task</span> <span class="ruby-operator">|</span> <span class="ruby-operator">!</span> <span class="ruby-identifier">task</span>.<span class="ruby-identifier">active</span> }
240:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000216" class="method-detail">
        <a name="M000216"></a>

        <div class="method-heading">
          <a href="#M000216" class="method-signature">
          <span class="method-name">label</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Helper method which returns a user-displayable <a
href="Report.html#M000216">label</a> describing this report type.
There&#8216;s a class method equivalent below.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000216-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000216-source">
<pre>
     <span class="ruby-comment cmt"># File lib/track_record_report.rb, line 316</span>
316:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">label</span>
317:       <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@frequency_data</span>[ <span class="ruby-identifier">:label</span> ]
318:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000222" class="method-detail">
        <a name="M000222"></a>

        <div class="method-heading">
          <a href="#M000222" class="method-signature">
          <span class="method-name">partial_column?</span><span class="method-args">( col_index )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Does the column at the given index only contain partial results, because it
is the first or last column in the overall range and that range starts or
ends somewhere in the middle? Returns &#8216;true&#8217; if so, else
&#8216;false&#8217;.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000222-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000222-source">
<pre>
     <span class="ruby-comment cmt"># File lib/track_record_report.rb, line 362</span>
362:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">partial_column?</span>( <span class="ruby-identifier">col_index</span> )
363: 
364: <span class="ruby-comment cmt"># [TODO] Doesn't work, because col_range accurately reflects the column range</span>
365: <span class="ruby-comment cmt">#        rather than the quantised range. Getting at the latter is tricky, so</span>
366: <span class="ruby-comment cmt">#        leaving this for later. At present the method is only used for display</span>
367: <span class="ruby-comment cmt">#        purposes in the column headings.</span>
368: 
369:       <span class="ruby-identifier">col_range</span> = <span class="ruby-ivar">@column_ranges</span>[ <span class="ruby-identifier">col_index</span> ]
370:       <span class="ruby-keyword kw">return</span> ( <span class="ruby-identifier">col_range</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">&lt;</span> <span class="ruby-ivar">@range</span>.<span class="ruby-identifier">first</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">col_range</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@range</span>.<span class="ruby-identifier">last</span> )
371:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000210" class="method-detail">
        <a name="M000210"></a>

        <div class="method-heading">
          <a href="#M000210" class="method-signature">
          <span class="method-name">task_ids=</span><span class="method-args">( ids )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Build the &#8216;tasks&#8217; array if &#8216;task_ids&#8217; is updated
externally.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000210-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000210-source">
<pre>
     <span class="ruby-comment cmt"># File lib/track_record_report.rb, line 252</span>
252:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">task_ids=</span>( <span class="ruby-identifier">ids</span> )
253:       <span class="ruby-ivar">@task_ids</span> = <span class="ruby-identifier">map_raw_ids</span>( <span class="ruby-identifier">ids</span> )
254:       <span class="ruby-identifier">assign_tasks_from_ids</span>( <span class="ruby-ivar">@task_ids</span> )
255:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000209" class="method-detail">
        <a name="M000209"></a>

        <div class="method-heading">
          <a href="#M000209" class="method-signature">
          <span class="method-name">tasks=</span><span class="method-args">( array )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Set a task array directly (will always be filtered according to security
settings for the current user).
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000209-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000209-source">
<pre>
     <span class="ruby-comment cmt"># File lib/track_record_report.rb, line 245</span>
245:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">tasks=</span>( <span class="ruby-identifier">array</span> )
246:       <span class="ruby-ivar">@tasks</span> = <span class="ruby-identifier">array</span>
247:       <span class="ruby-identifier">update_internal_task_lists</span>()
248:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000213" class="method-detail">
        <a name="M000213"></a>

        <div class="method-heading">
          <a href="#M000213" class="method-signature">
          <span class="method-name">user_ids=</span><span class="method-args">( ids )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Build the &#8216;user&#8217; array if &#8216;user_ids&#8217; is updated
externally.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000213-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000213-source">
<pre>
     <span class="ruby-comment cmt"># File lib/track_record_report.rb, line 275</span>
275:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">user_ids=</span>( <span class="ruby-identifier">ids</span> )
276:       <span class="ruby-identifier">ids</span> <span class="ruby-operator">||=</span> []
277:       <span class="ruby-identifier">ids</span> = <span class="ruby-identifier">ids</span>.<span class="ruby-identifier">values</span> <span class="ruby-keyword kw">if</span> ( <span class="ruby-identifier">ids</span>.<span class="ruby-identifier">is_a?</span>( <span class="ruby-constant">Hash</span> ) <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">ids</span>.<span class="ruby-identifier">is_a?</span>( <span class="ruby-constant">HashWithIndifferentAccess</span> ) )
278:       <span class="ruby-ivar">@user_ids</span> = <span class="ruby-identifier">ids</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span> <span class="ruby-identifier">str</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">str</span>.<span class="ruby-identifier">to_i</span> }
279: 
280:       <span class="ruby-comment cmt"># Security - if the current user is restricted they might try and hack</span>
281:       <span class="ruby-comment cmt"># the form to view other user details.</span>
282: 
283:       <span class="ruby-keyword kw">if</span> ( <span class="ruby-ivar">@current_user</span>.<span class="ruby-identifier">restricted?</span> )
284:         <span class="ruby-ivar">@user_ids</span> = [ <span class="ruby-ivar">@current_user</span>.<span class="ruby-identifier">id</span> ] <span class="ruby-keyword kw">unless</span>( <span class="ruby-ivar">@user_ids</span>.<span class="ruby-identifier">empty?</span> )
285:       <span class="ruby-keyword kw">end</span>
286: 
287:       <span class="ruby-comment cmt"># Turn the list of (now numeric) user IDs into user objects.</span>
288: 
289:       <span class="ruby-ivar">@users</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">active</span>.<span class="ruby-identifier">find</span>( <span class="ruby-ivar">@user_ids</span> )
290:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>