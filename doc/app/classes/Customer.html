<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Customer</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Customer</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/app/models/customer_rb.html">
                app/models/customer.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="TaskGroup.html">
                TaskGroup
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <table>
<tr><td valign="top">File:</td><td>customer.rb

</td></tr>
<tr><td valign="top">(C):</td><td>Hipposoft 2008, 2009

</td></tr>
<tr><td valign="top">Purpose:</td><td>Describe the behaviour of <a href="Customer.html">Customer</a> objects. See
below for more details.

</td></tr>
</table>
<hr size="10"></hr><pre>
          24-Dec-2007 (ADH): Created.
</pre>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000134">apply_default_sort_order</a>&nbsp;&nbsp;
      <a href="#M000133">assign_defaults</a>&nbsp;&nbsp;
      <a href="#M000136">destroy_with_side_effects</a>&nbsp;&nbsp;
      <a href="#M000135">update_with_side_effects!</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000134" class="method-detail">
        <a name="M000134"></a>

        <div class="method-heading">
          <a href="#M000134" class="method-signature">
          <span class="method-name">apply_default_sort_order</span><span class="method-args">( array )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Apply a default sort to the given array of customer objects. The array is
modified in place. Although this method is compatible with the default sort
mechanism in the YUI tree view component, it&#8216;s not called by that
because the wider data set does not behave even remotely like
acts_as_nested_set style collections, so bespoke controller and view code
is used to generate arrays of objects.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000134-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000134-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/customer.rb, line 58</span>
58:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">apply_default_sort_order</span>( <span class="ruby-identifier">array</span> )
59:     <span class="ruby-identifier">array</span>.<span class="ruby-identifier">sort!</span> { <span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>, <span class="ruby-identifier">y</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">title</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">y</span>.<span class="ruby-identifier">title</span>.<span class="ruby-identifier">downcase</span> }
60:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000133" class="method-detail">
        <a name="M000133"></a>

        <div class="method-heading">
          <a href="#M000133" class="method-signature">
          <span class="method-name">assign_defaults</span><span class="method-args">( user )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Assign default conditions for a brand new object, used whether or not the
object ends up being saved in the database (so a before_create filter is
not sufficient). For user-specific default values, pass a <a
href="User.html">User</a> object.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000133-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000133-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/customer.rb, line 43</span>
43:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">assign_defaults</span>( <span class="ruby-identifier">user</span> )
44:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">active</span> = <span class="ruby-keyword kw">true</span>
45:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">code</span>   = <span class="ruby-value str">&quot;CID%04d&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">count</span>
46: 
47:     <span class="ruby-comment cmt"># Presently, there are no user-specific default values for</span>
48:     <span class="ruby-comment cmt"># Customer objects.</span>
49:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000136" class="method-detail">
        <a name="M000136"></a>

        <div class="method-heading">
          <a href="#M000136" class="method-signature">
          <span class="method-name">destroy_with_side_effects</span><span class="method-args">( destroy_projects = true, destroy_tasks = true )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
As <a href="Customer.html#M000135">update_with_side_effects!</a>, but
destroys things rather than updating them. Pass &#8216;true&#8217; to
destroy associated projects, else &#8216;false&#8217;. If omitted, defaults
to &#8216;true&#8217;; pass also &#8216;true&#8217; to destroy tasks
associated with those projects, else &#8216;false&#8217;, with, again, the
default being &#8216;true&#8217;.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000136-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000136-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/customer.rb, line 90</span>
90:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">destroy_with_side_effects</span>( <span class="ruby-identifier">destroy_projects</span> = <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">destroy_tasks</span> = <span class="ruby-keyword kw">true</span> )
91:     <span class="ruby-keyword kw">if</span> ( <span class="ruby-identifier">destroy_projects</span> )
92:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">projects</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">project</span> <span class="ruby-operator">|</span>
93:         <span class="ruby-identifier">project</span>.<span class="ruby-identifier">destroy_with_side_effects</span>( <span class="ruby-identifier">destroy_tasks</span> )
94:       <span class="ruby-keyword kw">end</span>
95:     <span class="ruby-keyword kw">end</span>
96: 
97:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">destroy</span>()
98:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000135" class="method-detail">
        <a name="M000135"></a>

        <div class="method-heading">
          <a href="#M000135" class="method-signature">
          <span class="method-name">update_with_side_effects!</span><span class="method-args">( attrs, update_projects = true, update_tasks = true )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Update an object with the given attributes. This is done by a special model
method because changes of the &#8216;active&#8217; flag have side effects
for other associated objects. THE CALLER *<b>MUST</b>* USE A TRANSACTION
around a call to this method. There is no need to call here unless the
&#8216;active&#8217; flag state is changing. Pass in &#8216;true&#8217; to
update associated projects, else &#8216;false&#8217; and &#8216;true&#8217;
to update associated tasks via those projects, else &#8216;false&#8217;.
Booleans default to &#8216;true&#8217; if omitted.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000135-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000135-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/customer.rb, line 71</span>
71:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_with_side_effects!</span>( <span class="ruby-identifier">attrs</span>, <span class="ruby-identifier">update_projects</span> = <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">update_tasks</span> = <span class="ruby-keyword kw">true</span> )
72:     <span class="ruby-identifier">active</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">active</span>
73:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">update_attributes!</span>( <span class="ruby-identifier">attrs</span> )
74: 
75:     <span class="ruby-comment cmt"># If the active flag has changed, deal with repercussions.</span>
76: 
77:     <span class="ruby-keyword kw">if</span> ( <span class="ruby-identifier">update_projects</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">attrs</span>[ <span class="ruby-identifier">:active</span> ] <span class="ruby-operator">!=</span> <span class="ruby-identifier">active</span> )
78:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">projects</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">project</span> <span class="ruby-operator">|</span>
79:         <span class="ruby-identifier">project</span>.<span class="ruby-identifier">update_with_side_effects!</span>( { <span class="ruby-identifier">:active</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">attrs</span>[ <span class="ruby-identifier">:active</span> ] }, <span class="ruby-identifier">update_tasks</span> )
80:       <span class="ruby-keyword kw">end</span>
81:     <span class="ruby-keyword kw">end</span>
82:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>