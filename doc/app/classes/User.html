<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: User</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">User</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/app/models/user_rb.html">
                app/models/user.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                ActiveRecord::Base
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <table>
<tr><td valign="top">File:</td><td>user.rb

</td></tr>
<tr><td valign="top">(C):</td><td>Hipposoft 2009

</td></tr>
<tr><td valign="top">Purpose:</td><td>Describe the behaviour of <a href="User.html">User</a> objects. See below
for more details.

</td></tr>
</table>
<hr size="10"></hr><pre>
          03-Jan-2008 (ADH): Created.
</pre>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000010">active_permitted_tasks</a>&nbsp;&nbsp;
      <a href="#M000015">admin?</a>&nbsp;&nbsp;
      <a href="#M000011">all_permitted_tasks</a>&nbsp;&nbsp;
      <a href="#M000017">assign_defaults</a>&nbsp;&nbsp;
      <a href="#M000014">manager?</a>&nbsp;&nbsp;
      <a href="#M000016">privileged?</a>&nbsp;&nbsp;
      <a href="#M000018">rationalise_id</a>&nbsp;&nbsp;
      <a href="#M000012">remove_inactive_tasks</a>&nbsp;&nbsp;
      <a href="#M000013">restricted?</a>&nbsp;&nbsp;
      <a href="#M000009">tasks_are_active</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">


    <div id="constants-list">
      <h3 class="section-bar">Constants</h3>

      <div class="name-list">
        <table summary="Constants">
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">DEFAULT_SORT_COLUMN</td>
          <td>=</td>
          <td class="context-item-value">'name'</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">DEFAULT_SORT_DIRECTION</td>
          <td>=</td>
          <td class="context-item-value">'ASC'</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">DEFAULT_SORT_ORDER</td>
          <td>=</td>
          <td class="context-item-value">&quot;#{ DEFAULT_SORT_COLUMN } #{ DEFAULT_SORT_DIRECTION }&quot;</td>
        </tr>
        </table>
      </div>
    </div>



      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000018" class="method-detail">
        <a name="M000018"></a>

        <div class="method-heading">
          <a href="#M000018" class="method-signature">
          <span class="method-name">rationalise_id</span><span class="method-args">( uri )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Class method - rationalise a URL for use with Open ID by ensuring that the
scheme and host are in lower case, the port nubmer is explicit and query or
fragment strings are stripped out. Only call for HTTP or HTTPS URLs. If
given &#8216;nil&#8217;, returns &#8216;nil&#8217;. If given something with
no apparent scheme, assumes &#8216;HTTP&#8217;.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000018-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000018-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/user.rb, line 197</span>
197:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">rationalise_id</span>( <span class="ruby-identifier">uri</span> )
198:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> ( <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">nil?</span> )
199: 
200:     <span class="ruby-identifier">uri</span>      = <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">strip</span>
201:     <span class="ruby-identifier">original</span> = <span class="ruby-constant">URI</span>.<span class="ruby-identifier">parse</span>( <span class="ruby-identifier">uri</span> )
202: 
203:     <span class="ruby-comment cmt"># Did the user omit the 'http' prefix? If so, the URI parser will</span>
204:     <span class="ruby-comment cmt"># be a bit confused. Try adding in 'http' instead.</span>
205: 
206:     <span class="ruby-identifier">orignal</span> = <span class="ruby-constant">URI</span>.<span class="ruby-identifier">parse</span>( <span class="ruby-node">&quot;http://#{uri}&quot;</span> ) <span class="ruby-keyword kw">if</span> ( <span class="ruby-identifier">original</span>.<span class="ruby-identifier">scheme</span>.<span class="ruby-identifier">nil?</span> )
207: 
208:     <span class="ruby-comment cmt"># We must by now have at least a scheme and host. If not, something</span>
209:     <span class="ruby-comment cmt"># very odd is going on - bail out.</span>
210: 
211:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">uri</span> <span class="ruby-keyword kw">if</span> ( <span class="ruby-identifier">original</span>.<span class="ruby-identifier">scheme</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">original</span>.<span class="ruby-identifier">host</span>.<span class="ruby-identifier">nil?</span> )
212: 
213:     <span class="ruby-comment cmt"># Looks good - assemble a clean equivalent.</span>
214: 
215:     <span class="ruby-keyword kw">if</span> ( <span class="ruby-identifier">original</span>.<span class="ruby-identifier">scheme</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'https'</span> )
216:       <span class="ruby-identifier">mod</span> = <span class="ruby-constant">URI</span><span class="ruby-operator">::</span><span class="ruby-constant">HTTPS</span>
217:     <span class="ruby-keyword kw">else</span>
218:       <span class="ruby-identifier">mod</span> = <span class="ruby-constant">URI</span><span class="ruby-operator">::</span><span class="ruby-constant">HTTP</span>
219:     <span class="ruby-keyword kw">end</span>
220: 
221:     <span class="ruby-identifier">rational</span> = <span class="ruby-identifier">mod</span>.<span class="ruby-identifier">build</span>( {
222:       <span class="ruby-identifier">:scheme</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">original</span>.<span class="ruby-identifier">scheme</span>.<span class="ruby-identifier">downcase</span>,
223:       <span class="ruby-identifier">:host</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">original</span>.<span class="ruby-identifier">host</span>.<span class="ruby-identifier">downcase</span>,
224:       <span class="ruby-identifier">:port</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">original</span>.<span class="ruby-identifier">port</span>,
225:       <span class="ruby-identifier">:path</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">original</span>.<span class="ruby-identifier">path</span>
226:     } )
227: 
228:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">rational</span>.<span class="ruby-identifier">to_s</span>()
229: 
230:   <span class="ruby-keyword kw">rescue</span>
231: 
232:     <span class="ruby-comment cmt"># Catch URI parser exceptions by just bailing out</span>
233: 
234:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">uri</span>
235:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000010" class="method-detail">
        <a name="M000010"></a>

        <div class="method-heading">
          <a href="#M000010" class="method-signature">
          <span class="method-name">active_permitted_tasks</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Find all tasks which this user is permitted to see; only active tasks are
returned. Returns an association-like object on which other methods may be
called, e.g. a &quot;find&quot; call, a &quot;count&quot; (for efficient
counting of items without needing a special additional count method), and
so-on.
</p>
<p>
Call this rather than &quot;user.tasks.active&quot; if you want to retrieve
valid task lists even for privileged users, where otherwise there may be no
assigned task list (since privileged users can view anything anyway) and
&quot;user.tasks&quot; would thus return nothing. Note that the actual
assigned task list for privileged users, if any, will be IGNORED by this
call.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000010-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000010-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/user.rb, line 111</span>
111:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">active_permitted_tasks</span>
112:     ( <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">restricted?</span> ) <span class="ruby-operator">?</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">tasks</span>.<span class="ruby-identifier">active</span> <span class="ruby-operator">:</span> <span class="ruby-constant">Task</span>.<span class="ruby-identifier">active</span>
113:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000015" class="method-detail">
        <a name="M000015"></a>

        <div class="method-heading">
          <a href="#M000015" class="method-signature">
          <span class="method-name">admin?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Is this user an administrator? This generally means full read/write system
access. This does given the potential to completely break the system (e.g.
delete a user&#8216;s control panel but not the user), although steps are
taken to try and protect against it. In the end, though, an administrator
is assumed to be With Clue.
</p>
<p>
See also &quot;<a href="User.html#M000016">privileged?</a>&quot; and
&quot;<a href="User.html#M000014">manager?</a>&quot;. Administrators are
considered to be both managers and privileged.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000015-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000015-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/user.rb, line 156</span>
156:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">admin?</span>
157:     <span class="ruby-keyword kw">return</span> ( <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">user_type</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'Admin'</span> )
158:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000011" class="method-detail">
        <a name="M000011"></a>

        <div class="method-heading">
          <a href="#M000011" class="method-signature">
          <span class="method-name">all_permitted_tasks</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
As &#8216;permitted_tasks&#8217; above, but returns details for both active
and inactive tasks.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000011-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000011-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/user.rb, line 118</span>
118:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">all_permitted_tasks</span>
119:     ( <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">restricted?</span> ) <span class="ruby-operator">?</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">tasks</span> <span class="ruby-operator">:</span> <span class="ruby-constant">Task</span>.<span class="ruby-identifier">all</span>
120:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000017" class="method-detail">
        <a name="M000017"></a>

        <div class="method-heading">
          <a href="#M000017" class="method-signature">
          <span class="method-name">assign_defaults</span><span class="method-args">( user, identity_url = nil, user_type = nil )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Assign default conditions for a brand new object. The interface is a little
odd. If given a user in the first parameter, then it is assumed that this
user is setting up a new user; the new user details are created as a blank
template. If given nil then an identity URL and optional user type, it is
assumed that a new user account is being auto-created for that identity URL
and defaults are assigned accordingly. If omitted, the user type will be
set to &quot;Normal&quot;.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000017-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000017-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/user.rb, line 175</span>
175:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">assign_defaults</span>( <span class="ruby-identifier">user</span>, <span class="ruby-identifier">identity_url</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">user_type</span> = <span class="ruby-keyword kw">nil</span> )
176:     <span class="ruby-keyword kw">if</span> ( <span class="ruby-identifier">user</span>.<span class="ruby-identifier">nil?</span> )
177:       <span class="ruby-identifier">user_type</span>    = <span class="ruby-identifier">user_type</span> <span class="ruby-operator">||</span> <span class="ruby-value str">'Normal'</span>
178:     <span class="ruby-keyword kw">else</span>
179:       <span class="ruby-identifier">identity_url</span> = <span class="ruby-value str">''</span>
180:       <span class="ruby-identifier">user_type</span>    = <span class="ruby-value str">'Normal'</span>
181:     <span class="ruby-keyword kw">end</span>
182: 
183:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">code</span>         = <span class="ruby-value str">&quot;UID%04d&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-constant">User</span>.<span class="ruby-identifier">count</span>
184:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">active</span>       = <span class="ruby-keyword kw">true</span>
185:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">name</span>         = <span class="ruby-value str">''</span>
186:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">email</span>        = <span class="ruby-value str">''</span>
187:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">identity_url</span> = <span class="ruby-identifier">identity_url</span>
188:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">user_type</span>    = <span class="ruby-identifier">user_type</span>
189:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000014" class="method-detail">
        <a name="M000014"></a>

        <div class="method-heading">
          <a href="#M000014" class="method-signature">
          <span class="method-name">manager?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Is this user a <a href="User.html#M000014">manager?</a> This generally
means elevated privileges but still no full read/write system access for
safety. See also &quot;<a href="User.html#M000016">privileged?</a>&quot; -
manager accounts are considered privileged.
</p>
<p>
Administrators acquire manager privileges in passing.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000014-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000014-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/user.rb, line 143</span>
143:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">manager?</span>
144:     <span class="ruby-keyword kw">return</span> ( <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">user_type</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'Manager'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">user_type</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'Admin'</span> )
145:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000016" class="method-detail">
        <a name="M000016"></a>

        <div class="method-heading">
          <span class="method-name">privileged?</span><span class="method-args">()</span>
        </div>
      
        <div class="method-description">
          <p>
Alias for manager?
</p>
        </div>
      </div>

      <div id="method-M000012" class="method-detail">
        <a name="M000012"></a>

        <div class="method-heading">
          <a href="#M000012" class="method-signature">
          <span class="method-name">remove_inactive_tasks</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Remove inactive tasks from a user&#8216;s tasks list. The caller is
responsible for saving the updated object.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000012-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000012-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/user.rb, line 125</span>
125:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">remove_inactive_tasks</span>
126:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">tasks</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">tasks</span>.<span class="ruby-identifier">active</span>
127:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000013" class="method-detail">
        <a name="M000013"></a>

        <div class="method-heading">
          <a href="#M000013" class="method-signature">
          <span class="method-name">restricted?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Is this user <a href="User.html#M000013">restricted?</a> This generally
means they can only see anything related to tasks belonging to this user,
which only a manager or administrator can assign. See also &quot;<a
href="User.html#M000016">privileged?</a>&quot;.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000013-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000013-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/user.rb, line 133</span>
133:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">restricted?</span>
134:     <span class="ruby-keyword kw">return</span> ( <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">user_type</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'Normal'</span> )
135:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000009" class="method-detail">
        <a name="M000009"></a>

        <div class="method-heading">
          <a href="#M000009" class="method-signature">
          <span class="method-name">tasks_are_active</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000009-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000009-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/user.rb, line 85</span>
85:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">tasks_are_active</span>
86:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">tasks</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">task</span> <span class="ruby-operator">|</span>
87:       <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add_to_base</span>( <span class="ruby-node">&quot;Cannot assign task '#{ task.title }' to this user - it is no longer active&quot;</span> ) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">task</span>.<span class="ruby-identifier">active</span>
88:     <span class="ruby-keyword kw">end</span>
89:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>