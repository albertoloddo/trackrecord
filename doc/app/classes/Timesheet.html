<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Timesheet</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Timesheet</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/app/models/timesheet_rb.html">
                app/models/timesheet.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                ActiveRecord::Base
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <table>
<tr><td valign="top">File:</td><td>timesheet.rb

</td></tr>
<tr><td valign="top">(C):</td><td>Hipposoft 2008, 2009

</td></tr>
<tr><td valign="top">Purpose:</td><td>Describe the behaviour of <a href="Timesheet.html">Timesheet</a> objects.
See below for more details.

</td></tr>
</table>
<hr size="10"></hr><pre>
          07-Jan-2008 (ADH): Created.
</pre>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000115">add_row</a>&nbsp;&nbsp;
      <a href="#M000104">allowed_range</a>&nbsp;&nbsp;
      <a href="#M000107">can_be_modified_by?</a>&nbsp;&nbsp;
      <a href="#M000116">column_sum</a>&nbsp;&nbsp;
      <a href="#M000122">date_for</a>&nbsp;&nbsp;
      <a href="#M000123">date_for</a>&nbsp;&nbsp;
      <a href="#M000114">discover_week</a>&nbsp;&nbsp;
      <a href="#M000112">editable_week</a>&nbsp;&nbsp;
      <a href="#M000108">find_mine</a>&nbsp;&nbsp;
      <a href="#M000109">find_mine_committed</a>&nbsp;&nbsp;
      <a href="#M000110">find_mine_uncommitted</a>&nbsp;&nbsp;
      <a href="#M000119">get_first_week_start</a>&nbsp;&nbsp;
      <a href="#M000120">get_last_week_end</a>&nbsp;&nbsp;
      <a href="#M000121">get_last_week_number</a>&nbsp;&nbsp;
      <a href="#M000106">is_permitted_for?</a>&nbsp;&nbsp;
      <a href="#M000113">showable_week</a>&nbsp;&nbsp;
      <a href="#M000118">start_day</a>&nbsp;&nbsp;
      <a href="#M000117">total_sum</a>&nbsp;&nbsp;
      <a href="#M000111">unused_weeks</a>&nbsp;&nbsp;
      <a href="#M000105">used_range</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">


    <div id="constants-list">
      <h3 class="section-bar">Constants</h3>

      <div class="name-list">
        <table summary="Constants">
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">DEFAULT_SORT_COLUMN</td>
          <td>=</td>
          <td class="context-item-value">'year, week_number'</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">DEFAULT_SORT_DIRECTION</td>
          <td>=</td>
          <td class="context-item-value">'DESC'</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">DEFAULT_SORT_ORDER</td>
          <td>=</td>
          <td class="context-item-value">&quot;#{ DEFAULT_SORT_COLUMN } #{ DEFAULT_SORT_DIRECTION }&quot;</td>
        </tr>
        </table>
      </div>
    </div>



      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000104" class="method-detail">
        <a name="M000104"></a>

        <div class="method-heading">
          <a href="#M000104" class="method-signature">
          <span class="method-name">allowed_range</span><span class="method-args">( accurate = false )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Return a range of years allowed for a timesheet. Optionally pass
&#8216;true&#8217; if you want an actual Date object range rather than just
a year range.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000104-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000104-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/timesheet.rb, line 60</span>
60:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">allowed_range</span>( <span class="ruby-identifier">accurate</span> = <span class="ruby-keyword kw">false</span> )
61:     <span class="ruby-keyword kw">if</span> ( <span class="ruby-constant">WorkPacket</span>.<span class="ruby-identifier">significant</span>.<span class="ruby-identifier">count</span>.<span class="ruby-identifier">zero?</span> )
62:       <span class="ruby-identifier">range</span> = ( <span class="ruby-constant">Date</span>.<span class="ruby-identifier">current</span>.<span class="ruby-identifier">year</span> <span class="ruby-operator">-</span> <span class="ruby-value">2</span> )<span class="ruby-operator">..</span>( <span class="ruby-constant">Date</span>.<span class="ruby-identifier">current</span>.<span class="ruby-identifier">year</span> <span class="ruby-operator">+</span> <span class="ruby-value">2</span> )
63:     <span class="ruby-keyword kw">else</span>
64:       <span class="ruby-identifier">range</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">used_range</span>
65:       <span class="ruby-identifier">range</span> = ( <span class="ruby-identifier">range</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">-</span> <span class="ruby-value">2</span> )<span class="ruby-operator">..</span>( <span class="ruby-identifier">range</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">+</span> <span class="ruby-value">2</span> )
66:     <span class="ruby-keyword kw">end</span>
67: 
68:     <span class="ruby-keyword kw">if</span> ( <span class="ruby-identifier">accurate</span> )
69:       ( <span class="ruby-constant">Date</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">range</span>.<span class="ruby-identifier">first</span>, <span class="ruby-value">1</span>, <span class="ruby-value">1</span> ) )<span class="ruby-operator">..</span>( <span class="ruby-constant">Date</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">range</span>.<span class="ruby-identifier">last</span>, <span class="ruby-value">12</span>, <span class="ruby-value">31</span> ) )
70:     <span class="ruby-keyword kw">else</span>
71:       <span class="ruby-identifier">range</span>
72:     <span class="ruby-keyword kw">end</span>
73:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000123" class="method-detail">
        <a name="M000123"></a>

        <div class="method-heading">
          <a href="#M000123" class="method-signature">
          <span class="method-name">date_for</span><span class="method-args">( year, week_number, day_number, as_date = false )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Class method; as <a href="Timesheet.html#M000122">date_for</a>, but pass
explicitly the year, week number and day number of interest. If an optional
fourth parameter is &#8216;true&#8217;, returns a Date object rather than a
string.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000123-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000123-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/timesheet.rb, line 405</span>
405:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">date_for</span>( <span class="ruby-identifier">year</span>, <span class="ruby-identifier">week_number</span>, <span class="ruby-identifier">day_number</span>, <span class="ruby-identifier">as_date</span> = <span class="ruby-keyword kw">false</span> )
406: 
407:     <span class="ruby-comment cmt"># Get the date of Monday, week 1 in this timesheet's year.</span>
408:     <span class="ruby-comment cmt"># Add as many days as needed to get to Monday of the week</span>
409:     <span class="ruby-comment cmt"># for this timesheet.</span>
410: 
411:     <span class="ruby-identifier">date</span> = <span class="ruby-constant">Timesheet</span>.<span class="ruby-identifier">get_first_week_start</span>( <span class="ruby-identifier">year</span> )
412:     <span class="ruby-identifier">date</span> = <span class="ruby-identifier">date</span> <span class="ruby-operator">+</span> ( ( <span class="ruby-identifier">week_number</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span> ) <span class="ruby-operator">*</span> <span class="ruby-value">7</span> )
413: 
414:     <span class="ruby-comment cmt"># Add in the day number offset.</span>
415: 
416:     <span class="ruby-identifier">date</span> <span class="ruby-operator">+=</span> <span class="ruby-constant">TimesheetRow</span><span class="ruby-operator">::</span><span class="ruby-constant">DAY_ORDER</span>.<span class="ruby-identifier">index</span>( <span class="ruby-identifier">day_number</span> )
417: 
418:     <span class="ruby-comment cmt"># Return in DD-Mth-YYYY format, or as a Date object?</span>
419: 
420:     <span class="ruby-keyword kw">if</span> ( <span class="ruby-identifier">as_date</span> )
421:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">date</span>
422:     <span class="ruby-keyword kw">else</span>
423:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">date</span>.<span class="ruby-identifier">strftime</span>( <span class="ruby-value str">'%d-%b-%Y'</span>) <span class="ruby-comment cmt"># Or ISO: '%Y-%m-%d'</span>
424:     <span class="ruby-keyword kw">end</span>
425:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000119" class="method-detail">
        <a name="M000119"></a>

        <div class="method-heading">
          <a href="#M000119" class="method-signature">
          <span class="method-name">get_first_week_start</span><span class="method-args">( year )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Get the date of the first day of week 1 in the given year. Note that
sometimes, this can be in December the previous year. Works on commercial
weeks (Mon-&gt;Sun). Returns a Date.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000119-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000119-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/timesheet.rb, line 295</span>
295:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">get_first_week_start</span>( <span class="ruby-identifier">year</span> )
296: 
297:     <span class="ruby-comment cmt"># Is Jan 1st already in week 1?</span>
298: 
299:     <span class="ruby-identifier">date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">year</span>, <span class="ruby-value">1</span>, <span class="ruby-value">1</span> )
300: 
301:     <span class="ruby-keyword kw">if</span> ( <span class="ruby-identifier">date</span>.<span class="ruby-identifier">cweek</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> )
302: 
303:       <span class="ruby-comment cmt"># Yes. Check December of the previous year.</span>
304: 
305:       <span class="ruby-value">31</span>.<span class="ruby-identifier">downto</span>( <span class="ruby-value">25</span> ) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">day</span> <span class="ruby-operator">|</span>
306:         <span class="ruby-identifier">date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">year</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>, <span class="ruby-value">12</span>, <span class="ruby-identifier">day</span> )
307: 
308:         <span class="ruby-comment cmt"># If we encounter a date in the previous year which has a week</span>
309:         <span class="ruby-comment cmt"># number &gt; 1, then that's the last week of the previous year. If</span>
310:         <span class="ruby-comment cmt"># we're on Dec 31st that means that week 1 started on Jan 1st,</span>
311:         <span class="ruby-comment cmt"># else in December on</span>
312: 
313:         <span class="ruby-keyword kw">if</span> ( <span class="ruby-identifier">date</span>.<span class="ruby-identifier">cweek</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> )
314:           <span class="ruby-keyword kw">return</span> ( <span class="ruby-identifier">day</span> <span class="ruby-operator">==</span> <span class="ruby-value">31</span> <span class="ruby-operator">?</span> <span class="ruby-constant">Date</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">year</span>, <span class="ruby-value">1</span>, <span class="ruby-value">1</span> ) <span class="ruby-operator">:</span> <span class="ruby-constant">Date</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">year</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>, <span class="ruby-value">12</span>, <span class="ruby-identifier">day</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span> ) )
315:         <span class="ruby-keyword kw">end</span>
316:       <span class="ruby-keyword kw">end</span>
317: 
318:     <span class="ruby-keyword kw">else</span>
319: 
320:       <span class="ruby-comment cmt"># No. Walk forward through January until we reach week 1.</span>
321: 
322:       <span class="ruby-value">2</span>.<span class="ruby-identifier">upto</span>( <span class="ruby-value">7</span> ) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">day</span> <span class="ruby-operator">|</span>
323:         <span class="ruby-identifier">date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">year</span>, <span class="ruby-value">1</span>, <span class="ruby-identifier">day</span> )
324:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">date</span> <span class="ruby-keyword kw">if</span> ( <span class="ruby-identifier">date</span>.<span class="ruby-identifier">cweek</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> )
325:       <span class="ruby-keyword kw">end</span>
326:     <span class="ruby-keyword kw">end</span>
327:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000120" class="method-detail">
        <a name="M000120"></a>

        <div class="method-heading">
          <a href="#M000120" class="method-signature">
          <span class="method-name">get_last_week_end</span><span class="method-args">( year )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Get the date of the last day of the last week in the given year. Note that
sometimes, this can be in January in the following year. Works on
commercial weeks (Mon-&gt;Sun). Returns a Date.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000120-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000120-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/timesheet.rb, line 333</span>
333:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">get_last_week_end</span>( <span class="ruby-identifier">year</span> )
334: 
335:     <span class="ruby-comment cmt"># Is Dec 31st already in week 1 for the next year?</span>
336: 
337:     <span class="ruby-identifier">date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">year</span>, <span class="ruby-value">12</span>, <span class="ruby-value">31</span> )
338: 
339:     <span class="ruby-keyword kw">if</span> ( <span class="ruby-identifier">date</span>.<span class="ruby-identifier">cweek</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> )
340: 
341:       <span class="ruby-comment cmt"># Yes. Check backwards through December to find the last day</span>
342:       <span class="ruby-comment cmt"># in the higher week number.</span>
343: 
344:       <span class="ruby-value">30</span>.<span class="ruby-identifier">downto</span>( <span class="ruby-value">25</span> ) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">day</span> <span class="ruby-operator">|</span>
345:         <span class="ruby-identifier">date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">year</span>, <span class="ruby-value">12</span>, <span class="ruby-identifier">day</span> )
346:         <span class="ruby-keyword kw">return</span> <span class="ruby-constant">Date</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">year</span>, <span class="ruby-value">12</span>, <span class="ruby-identifier">day</span> ) <span class="ruby-keyword kw">if</span> ( <span class="ruby-identifier">date</span>.<span class="ruby-identifier">cweek</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> )
347:       <span class="ruby-keyword kw">end</span>
348: 
349:     <span class="ruby-keyword kw">else</span>
350: 
351:       <span class="ruby-comment cmt"># No. Check January of the following year to find the end</span>
352:       <span class="ruby-comment cmt"># of the highest numbered week.</span>
353: 
354:       <span class="ruby-value">1</span>.<span class="ruby-identifier">upto</span>( <span class="ruby-value">6</span> ) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">day</span> <span class="ruby-operator">|</span>
355:         <span class="ruby-identifier">date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">year</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>, <span class="ruby-identifier">day</span> )
356:         <span class="ruby-keyword kw">if</span> ( <span class="ruby-identifier">date</span>.<span class="ruby-identifier">cweek</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> )
357:           <span class="ruby-keyword kw">return</span> ( <span class="ruby-identifier">day</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-operator">?</span> <span class="ruby-constant">Date</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">year</span>, <span class="ruby-value">12</span>, <span class="ruby-value">31</span> ) <span class="ruby-operator">:</span> <span class="ruby-constant">Date</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">year</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>, <span class="ruby-identifier">day</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span> ) )
358:         <span class="ruby-keyword kw">end</span>
359:       <span class="ruby-keyword kw">end</span>
360:     <span class="ruby-keyword kw">end</span>
361:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000121" class="method-detail">
        <a name="M000121"></a>

        <div class="method-heading">
          <a href="#M000121" class="method-signature">
          <span class="method-name">get_last_week_number</span><span class="method-args">( year )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Get the number of the last commercial week (Mon-&gt;Sun) in the given year.
This is usually 52, but is 53 for some years.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000121-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000121-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/timesheet.rb, line 366</span>
366:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">get_last_week_number</span>( <span class="ruby-identifier">year</span> )
367: 
368:     <span class="ruby-comment cmt"># Is Dec 31st already in week 1 for the next year?</span>
369: 
370:     <span class="ruby-identifier">date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">year</span>, <span class="ruby-value">12</span>, <span class="ruby-value">31</span> )
371: 
372:     <span class="ruby-keyword kw">if</span> ( <span class="ruby-identifier">date</span>.<span class="ruby-identifier">cweek</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> )
373: 
374:       <span class="ruby-comment cmt"># Yes. Check backwards through December to find the last day</span>
375:       <span class="ruby-comment cmt"># in the higher week number.</span>
376: 
377:       <span class="ruby-value">30</span>.<span class="ruby-identifier">downto</span>( <span class="ruby-value">25</span> ) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">day</span> <span class="ruby-operator">|</span>
378:         <span class="ruby-identifier">date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">year</span>, <span class="ruby-value">12</span>, <span class="ruby-identifier">day</span> )
379:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">date</span>.<span class="ruby-identifier">cweek</span> <span class="ruby-keyword kw">if</span> ( <span class="ruby-identifier">date</span>.<span class="ruby-identifier">cweek</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> )
380:       <span class="ruby-keyword kw">end</span>
381: 
382:     <span class="ruby-keyword kw">else</span>
383: 
384:       <span class="ruby-comment cmt"># No, so we have the highest week already.</span>
385: 
386:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">date</span>.<span class="ruby-identifier">cweek</span>
387:     <span class="ruby-keyword kw">end</span>
388:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000105" class="method-detail">
        <a name="M000105"></a>

        <div class="method-heading">
          <a href="#M000105" class="method-signature">
          <span class="method-name">used_range</span><span class="method-args">( accurate = false )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Return a range of years used by all current timesheets, or the allowed
range (see above) if there are no work packets. Optionally pass
&#8216;true&#8217; if you want an actual Date object range rather than just
a year range.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000105-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000105-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/timesheet.rb, line 79</span>
79:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">used_range</span>( <span class="ruby-identifier">accurate</span> = <span class="ruby-keyword kw">false</span> )
80:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">allowed_range</span>( <span class="ruby-identifier">accurate</span> ) <span class="ruby-keyword kw">if</span> <span class="ruby-constant">WorkPacket</span>.<span class="ruby-identifier">significant</span>.<span class="ruby-identifier">count</span>.<span class="ruby-identifier">zero?</span>
81: 
82:     <span class="ruby-identifier">first</span> = <span class="ruby-constant">WorkPacket</span>.<span class="ruby-identifier">find_earliest_by_tasks</span>()
83:     <span class="ruby-identifier">last</span>  = <span class="ruby-constant">WorkPacket</span>.<span class="ruby-identifier">find_latest_by_tasks</span>()
84: 
85:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">accurate</span>
86:       ( <span class="ruby-identifier">first</span>.<span class="ruby-identifier">date</span>.<span class="ruby-identifier">to_date</span> )<span class="ruby-operator">..</span>( <span class="ruby-identifier">last</span>.<span class="ruby-identifier">date</span>.<span class="ruby-identifier">to_date</span> )
87:     <span class="ruby-keyword kw">else</span>
88:       ( <span class="ruby-identifier">first</span>.<span class="ruby-identifier">date</span>.<span class="ruby-identifier">year</span> )<span class="ruby-operator">..</span>( <span class="ruby-identifier">last</span>.<span class="ruby-identifier">date</span>.<span class="ruby-identifier">year</span> )
89:     <span class="ruby-keyword kw">end</span>
90:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000115" class="method-detail">
        <a name="M000115"></a>

        <div class="method-heading">
          <a href="#M000115" class="method-signature">
          <span class="method-name">add_row</span><span class="method-args">( task )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Add a row to the timesheet using the given task object. Does nothing if a
row containing that task is already present. The updated timesheet is not
saved - the caller must do this.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000115-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000115-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/timesheet.rb, line 251</span>
251:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_row</span>( <span class="ruby-identifier">task</span> )
252:     <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">tasks</span>.<span class="ruby-identifier">include?</span>( <span class="ruby-identifier">task</span> )
253:       <span class="ruby-identifier">timesheet_row</span>      = <span class="ruby-constant">TimesheetRow</span>.<span class="ruby-identifier">new</span>
254:       <span class="ruby-identifier">timesheet_row</span>.<span class="ruby-identifier">task</span> = <span class="ruby-identifier">task</span>
255:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">timesheet_rows</span>.<span class="ruby-identifier">push</span>( <span class="ruby-identifier">timesheet_row</span> )
256:     <span class="ruby-keyword kw">end</span>
257:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000107" class="method-detail">
        <a name="M000107"></a>

        <div class="method-heading">
          <a href="#M000107" class="method-signature">
          <span class="method-name">can_be_modified_by?</span><span class="method-args">( user )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Is the given user permitted to update this timesheet?
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000107-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000107-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/timesheet.rb, line 137</span>
137:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">can_be_modified_by?</span>( <span class="ruby-identifier">user</span> )
138:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>  <span class="ruby-keyword kw">if</span>     ( <span class="ruby-identifier">user</span>.<span class="ruby-identifier">admin?</span> )
139:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">unless</span> ( <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">is_permitted_for?</span>( <span class="ruby-identifier">user</span> ) )
140:     <span class="ruby-keyword kw">return</span> ( <span class="ruby-keyword kw">not</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">committed</span> )
141:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000116" class="method-detail">
        <a name="M000116"></a>

        <div class="method-heading">
          <a href="#M000116" class="method-signature">
          <span class="method-name">column_sum</span><span class="method-args">( day_number )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Count the hours across all rows on the given day number; 0 is Sunday, 1-6
Monday to Saturday.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000116-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000116-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/timesheet.rb, line 262</span>
262:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">column_sum</span>( <span class="ruby-identifier">day_number</span> )
263:     <span class="ruby-identifier">sum</span> = <span class="ruby-value">0</span><span class="ruby-value">.0</span>
264: 
265:     <span class="ruby-comment cmt"># [TODO] Slow. Surely there's a better way...?</span>
266: 
267:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">timesheet_rows</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">timesheet_row</span> <span class="ruby-operator">|</span>
268:       <span class="ruby-identifier">work_packet</span> = <span class="ruby-constant">WorkPacket</span>.<span class="ruby-identifier">find_by_timesheet_row_id</span>(
269:         <span class="ruby-identifier">timesheet_row</span>.<span class="ruby-identifier">id</span>,
270:         <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:day_number</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">day_number</span> }
271:       )
272: 
273:       <span class="ruby-identifier">sum</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">work_packet</span>.<span class="ruby-identifier">worked_hours</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">work_packet</span>
274:     <span class="ruby-keyword kw">end</span>
275: 
276:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">sum</span>
277:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000122" class="method-detail">
        <a name="M000122"></a>

        <div class="method-heading">
          <a href="#M000122" class="method-signature">
          <span class="method-name">date_for</span><span class="method-args">( day_number, as_date = false )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Return a date string representing this timesheet on the given day number.
Day numbers are odd - 0 = Sunday at the <b>end</b> of this
timesheet&#8216;s week, while 1-6 = Monday at the <b>start</b> of the week
through to Saturday inclusive (although this may be changed; see the <a
href="TimesheetRow.html">TimesheetRow</a> model). If an optional second
parameter is &#8216;true&#8217;, returns a Date object rather than a
string.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000122-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000122-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/timesheet.rb, line 397</span>
397:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">date_for</span>( <span class="ruby-identifier">day_number</span>, <span class="ruby-identifier">as_date</span> = <span class="ruby-keyword kw">false</span> )
398:     <span class="ruby-constant">Timesheet</span>.<span class="ruby-identifier">date_for</span>( <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">year</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">week_number</span>, <span class="ruby-identifier">day_number</span>, <span class="ruby-identifier">as_date</span> )
399:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000114" class="method-detail">
        <a name="M000114"></a>

        <div class="method-heading">
          <a href="#M000114" class="method-signature">
          <span class="method-name">discover_week</span><span class="method-args">( nextweek ) {|timesheet| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Back-end to <a href="Timesheet.html#M000112">editable_week</a> and <a
href="Timesheet.html#M000113">showable_week</a>. See those functions for
details. Call with the next/previous week boolean and pass a block; this is
given a timesheet or nil; evaluate &#8216;true&#8217; to return details on
the item or &#8216;false&#8217; to move on to the next week.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000114-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000114-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/timesheet.rb, line 214</span>
214:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">discover_week</span>( <span class="ruby-identifier">nextweek</span> )
215:     <span class="ruby-identifier">year</span>  = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">year</span>
216:     <span class="ruby-identifier">owner</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">user_id</span>
217: 
218:     <span class="ruby-keyword kw">if</span> ( <span class="ruby-identifier">nextweek</span> )
219:       <span class="ruby-identifier">inc</span>   = <span class="ruby-value">1</span>
220:       <span class="ruby-identifier">week</span>  = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">week_number</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
221:       <span class="ruby-identifier">limit</span> = <span class="ruby-constant">Timesheet</span>.<span class="ruby-identifier">get_last_week_number</span>( <span class="ruby-identifier">year</span> ) <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
222: 
223:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> ( <span class="ruby-identifier">week</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">limit</span> )
224:     <span class="ruby-keyword kw">else</span>
225:       <span class="ruby-identifier">inc</span>   = <span class="ruby-value">-1</span>
226:       <span class="ruby-identifier">week</span>  = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">week_number</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>
227:       <span class="ruby-identifier">limit</span> = <span class="ruby-value">0</span>
228: 
229:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> ( <span class="ruby-identifier">week</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">limit</span> )
230:     <span class="ruby-keyword kw">end</span>
231: 
232:     <span class="ruby-keyword kw">while</span> ( <span class="ruby-identifier">week</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">limit</span> )
233:       <span class="ruby-identifier">timesheet</span> = <span class="ruby-constant">Timesheet</span>.<span class="ruby-identifier">find_by_user_id_and_year_and_week_number</span>(
234:         <span class="ruby-identifier">owner</span>, <span class="ruby-identifier">year</span>, <span class="ruby-identifier">week</span>
235:       )
236: 
237:       <span class="ruby-keyword kw">if</span> ( <span class="ruby-keyword kw">yield</span>( <span class="ruby-identifier">timesheet</span> ) )
238:         <span class="ruby-keyword kw">return</span> { <span class="ruby-identifier">:week_number</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">week</span>, <span class="ruby-identifier">:timesheet</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">timesheet</span> }
239:       <span class="ruby-keyword kw">end</span>
240: 
241:       <span class="ruby-identifier">week</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">inc</span>
242:     <span class="ruby-keyword kw">end</span>
243: 
244:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
245:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000112" class="method-detail">
        <a name="M000112"></a>

        <div class="method-heading">
          <a href="#M000112" class="method-signature">
          <span class="method-name">editable_week</span><span class="method-args">( nextweek )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Return the next (pass &#8216;true&#8217;) or previous (pass
&#8216;false&#8217;) editable week after this one, as a hash with
properties &#8216;week_number&#8217; and &#8216;timesheet&#8217;. The
latter will be populated with a timesheet if there is a not committed item
in the found week, or nil if the week has no associated timesheet yet.
Returns nil altogether if no editable week can be found (e.g. ask for
previous from week 1, or all previous weeks have committed timesheets on
them).
</p>
<p>
This operation may involve many database queries so is relatively slow.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000112-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000112-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/timesheet.rb, line 194</span>
194:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">editable_week</span>( <span class="ruby-identifier">nextweek</span> )
195:     <span class="ruby-identifier">discover_week</span>( <span class="ruby-identifier">nextweek</span> ) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">timesheet</span> <span class="ruby-operator">|</span>
196:       ( <span class="ruby-identifier">timesheet</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">timesheet</span>.<span class="ruby-identifier">committed</span> )
197:     <span class="ruby-keyword kw">end</span>
198:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000108" class="method-detail">
        <a name="M000108"></a>

        <div class="method-heading">
          <a href="#M000108" class="method-signature">
          <span class="method-name">find_mine</span><span class="method-args">( conditions = {} )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Instance method that returns an array of all timesheets owned by this user.
Pass an optional conditions hash (will be sent in as &quot;:conditions
=&gt; &lt;given value&gt;&quot;).
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000108-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000108-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/timesheet.rb, line 147</span>
147:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">find_mine</span>( <span class="ruby-identifier">conditions</span> = {} )
148:     <span class="ruby-constant">Timesheet</span>.<span class="ruby-identifier">find_all_by_user_id</span>( <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">conditions</span> )
149:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000109" class="method-detail">
        <a name="M000109"></a>

        <div class="method-heading">
          <a href="#M000109" class="method-signature">
          <span class="method-name">find_mine_committed</span><span class="method-args">( conditions = {} )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Instance method which returns an array of all committed timesheets owned by
this user.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000109-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000109-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/timesheet.rb, line 154</span>
154:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">find_mine_committed</span>( <span class="ruby-identifier">conditions</span> = {} )
155:     <span class="ruby-identifier">conditions</span>.<span class="ruby-identifier">merge!</span>( <span class="ruby-identifier">:committed</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span> )
156:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">find_mine</span>( <span class="ruby-identifier">conditions</span> )
157:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000110" class="method-detail">
        <a name="M000110"></a>

        <div class="method-heading">
          <a href="#M000110" class="method-signature">
          <span class="method-name">find_mine_uncommitted</span><span class="method-args">( conditions = {} )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Instance method which returns an array of all uncommitted timesheets owned
by this user.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000110-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000110-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/timesheet.rb, line 162</span>
162:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">find_mine_uncommitted</span>( <span class="ruby-identifier">conditions</span> = {} )
163:     <span class="ruby-identifier">conditions</span>.<span class="ruby-identifier">merge!</span>( <span class="ruby-identifier">:committed</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span> )
164:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">find_mine</span>( <span class="ruby-identifier">conditions</span> )
165:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000106" class="method-detail">
        <a name="M000106"></a>

        <div class="method-heading">
          <a href="#M000106" class="method-signature">
          <span class="method-name">is_permitted_for?</span><span class="method-args">( user )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Is the given user permitted to do anything with this timesheet?
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000106-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000106-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/timesheet.rb, line 131</span>
131:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">is_permitted_for?</span>( <span class="ruby-identifier">user</span> )
132:     <span class="ruby-keyword kw">return</span> ( <span class="ruby-identifier">user</span>.<span class="ruby-identifier">privileged?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">id</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">user</span>.<span class="ruby-identifier">id</span> )
133:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000113" class="method-detail">
        <a name="M000113"></a>

        <div class="method-heading">
          <a href="#M000113" class="method-signature">
          <span class="method-name">showable_week</span><span class="method-args">( nextweek )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
As <a href="Timesheet.html#M000112">editable_week</a>, but returns weeks
for &#8216;showable&#8217; weeks - that is, only weeks where a timesheet
owned by the current user already exists.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000113-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000113-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/timesheet.rb, line 203</span>
203:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">showable_week</span>( <span class="ruby-identifier">nextweek</span> )
204:     <span class="ruby-identifier">discover_week</span>( <span class="ruby-identifier">nextweek</span> ) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">timesheet</span> <span class="ruby-operator">|</span>
205:       ( <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">timesheet</span>.<span class="ruby-identifier">nil?</span> )
206:     <span class="ruby-keyword kw">end</span>
207:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000118" class="method-detail">
        <a name="M000118"></a>

        <div class="method-heading">
          <a href="#M000118" class="method-signature">
          <span class="method-name">start_day</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Return the date of the first day for this timesheet as a string.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000118-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000118-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/timesheet.rb, line 287</span>
287:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">start_day</span>()
288:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">date_for</span>( <span class="ruby-constant">TimesheetRow</span><span class="ruby-operator">::</span><span class="ruby-constant">FIRST_DAY</span> )
289:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000117" class="method-detail">
        <a name="M000117"></a>

        <div class="method-heading">
          <a href="#M000117" class="method-signature">
          <span class="method-name">total_sum</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Count the total number of worked hours in the whole timesheet.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000117-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000117-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/timesheet.rb, line 281</span>
281:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">total_sum</span>()
282:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">work_packets</span>.<span class="ruby-identifier">sum</span>( <span class="ruby-identifier">:worked_hours</span> )
283:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000111" class="method-detail">
        <a name="M000111"></a>

        <div class="method-heading">
          <a href="#M000111" class="method-signature">
          <span class="method-name">unused_weeks</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Return an array of week numbers which can be assigned to the timesheet.
Includes the current timesheet&#8216;s already allocated week.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000111-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000111-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/timesheet.rb, line 171</span>
171:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unused_weeks</span>()
172:     <span class="ruby-identifier">timesheets</span> = <span class="ruby-identifier">find_mine</span>( <span class="ruby-identifier">:year</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">year</span> )
173:     <span class="ruby-identifier">used_weeks</span> = <span class="ruby-identifier">timesheets</span>.<span class="ruby-identifier">collect</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">hash</span> <span class="ruby-operator">|</span>
174:       <span class="ruby-identifier">hash</span>[ <span class="ruby-identifier">:week_number</span> ]
175:     <span class="ruby-keyword kw">end</span>
176: 
177:     <span class="ruby-identifier">range</span>        = <span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-constant">Timesheet</span>.<span class="ruby-identifier">get_last_week_number</span>( <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">year</span> )
178:     <span class="ruby-identifier">unused_weeks</span> = ( <span class="ruby-identifier">range</span>.<span class="ruby-identifier">to_a</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">used_weeks</span> )
179:     <span class="ruby-identifier">unused_weeks</span>.<span class="ruby-identifier">push</span>( <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">week_number</span> ) <span class="ruby-keyword kw">unless</span> ( <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">week_number</span>.<span class="ruby-identifier">nil?</span> )
180: 
181:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">unused_weeks</span>.<span class="ruby-identifier">sort</span>()
182:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>