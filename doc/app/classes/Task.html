<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Task</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Task</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/app/models/task_rb.html">
                app/models/task.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                ActiveRecord::Base
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <table>
<tr><td valign="top">File:</td><td>task.rb

</td></tr>
<tr><td valign="top">(C):</td><td>Hipposoft 2008, 2009

</td></tr>
<tr><td valign="top">Purpose:</td><td>Describe the behaviour of <a href="Task.html">Task</a> objects. See below
for more details.

</td></tr>
</table>
<hr size="10"></hr><pre>
          24-Dec-2007 (ADH): Created.
</pre>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000073">assign_defaults</a>&nbsp;&nbsp;
      <a href="#M000070">augmented_title</a>&nbsp;&nbsp;
      <a href="#M000068">can_be_modified_by?</a>&nbsp;&nbsp;
      <a href="#M000076">committed_worked</a>&nbsp;&nbsp;
      <a href="#M000069">generate_xml_code</a>&nbsp;&nbsp;
      <a href="#M000067">is_permitted_for?</a>&nbsp;&nbsp;
      <a href="#M000077">not_committed_worked</a>&nbsp;&nbsp;
      <a href="#M000071">sort_by_augmented_title</a>&nbsp;&nbsp;
      <a href="#M000072">split_user_types</a>&nbsp;&nbsp;
      <a href="#M000078">sum_hours_over_range</a>&nbsp;&nbsp;
      <a href="#M000075">total_worked</a>&nbsp;&nbsp;
      <a href="#M000074">update_with_side_effects!</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">


    <div id="constants-list">
      <h3 class="section-bar">Constants</h3>

      <div class="name-list">
        <table summary="Constants">
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">DEFAULT_SORT_COLUMN</td>
          <td>=</td>
          <td class="context-item-value">'code'</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">DEFAULT_SORT_DIRECTION</td>
          <td>=</td>
          <td class="context-item-value">'ASC'</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">DEFAULT_SORT_ORDER</td>
          <td>=</td>
          <td class="context-item-value">&quot;#{ DEFAULT_SORT_COLUMN } #{ DEFAULT_SORT_DIRECTION }&quot;</td>
        </tr>
        </table>
      </div>
    </div>



      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000069" class="method-detail">
        <a name="M000069"></a>

        <div class="method-heading">
          <a href="#M000069" class="method-signature">
          <span class="method-name">generate_xml_code</span><span class="method-args">( id )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Given an ID, generate a task code for an XML-imported task based on the
current date.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000069-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000069-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/task.rb, line 95</span>
95:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">generate_xml_code</span>( <span class="ruby-identifier">id</span> )
96:     <span class="ruby-identifier">today</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">current</span>
97:     <span class="ruby-node">&quot;XML-%04d%02d%02d-#{ id }&quot;</span> <span class="ruby-operator">%</span> [ <span class="ruby-identifier">today</span>.<span class="ruby-identifier">year</span>, <span class="ruby-identifier">today</span>.<span class="ruby-identifier">month</span>, <span class="ruby-identifier">today</span>.<span class="ruby-identifier">day</span> ]
98:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000071" class="method-detail">
        <a name="M000071"></a>

        <div class="method-heading">
          <a href="#M000071" class="method-signature">
          <span class="method-name">sort_by_augmented_title</span><span class="method-args">( list )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Class method - sort an array of tasks by the augmented title. Since this
isn&#8216;t done by the database, it&#8216;s slow.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000071-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000071-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/task.rb, line 118</span>
118:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">sort_by_augmented_title</span>( <span class="ruby-identifier">list</span> )
119:     <span class="ruby-identifier">list</span>.<span class="ruby-identifier">sort!</span> { <span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>, <span class="ruby-identifier">y</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">augmented_title</span> <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">y</span>.<span class="ruby-identifier">augmented_title</span> }
120:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000073" class="method-detail">
        <a name="M000073"></a>

        <div class="method-heading">
          <a href="#M000073" class="method-signature">
          <span class="method-name">assign_defaults</span><span class="method-args">( user )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Assign default conditions for a brand new object, used whether or not the
object ends up being saved in the database (so a before_create filter is
not sufficient). For user-specific default values, pass a <a
href="User.html">User</a> object.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000073-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000073-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/task.rb, line 148</span>
148:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">assign_defaults</span>( <span class="ruby-identifier">user</span> )
149:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">duration</span> = <span class="ruby-value">0</span>
150:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">active</span>   = <span class="ruby-keyword kw">true</span>
151:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">code</span>     = <span class="ruby-value str">&quot;TID%05d&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-constant">Task</span>.<span class="ruby-identifier">count</span>
152: 
153:     <span class="ruby-comment cmt"># User-specific defaults - pick up the default project</span>
154:     <span class="ruby-comment cmt"># from the user's control panel, if defined.</span>
155: 
156:     <span class="ruby-keyword kw">if</span> ( <span class="ruby-identifier">user</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">control_panel</span> )
157:       <span class="ruby-identifier">cp</span> = <span class="ruby-identifier">user</span>.<span class="ruby-identifier">control_panel</span>
158:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">project</span> = <span class="ruby-identifier">cp</span>.<span class="ruby-identifier">project</span> <span class="ruby-keyword kw">if</span> ( <span class="ruby-identifier">cp</span>.<span class="ruby-identifier">project</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">cp</span>.<span class="ruby-identifier">project</span>.<span class="ruby-identifier">active</span> )
159:     <span class="ruby-keyword kw">end</span>
160:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000070" class="method-detail">
        <a name="M000070"></a>

        <div class="method-heading">
          <a href="#M000070" class="method-signature">
          <span class="method-name">augmented_title</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Return the &#8216;augmented&#8217; task title; that is, the task name, with
the project and customer names appended if available.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000070-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000070-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/task.rb, line 103</span>
103:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">augmented_title</span>
104:     <span class="ruby-keyword kw">if</span> ( <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">project</span> )
105:       <span class="ruby-keyword kw">if</span> ( <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">project</span>.<span class="ruby-identifier">customer</span> )
106:         <span class="ruby-keyword kw">return</span> <span class="ruby-node">&quot;#{ self.project.customer.title } - #{ self.project.title }: #{ self.title }&quot;</span>
107:       <span class="ruby-keyword kw">end</span>
108: 
109:       <span class="ruby-keyword kw">return</span> <span class="ruby-node">&quot;#{ self.project.title }: #{ self.title }&quot;</span>
110:     <span class="ruby-keyword kw">end</span>
111: 
112:     <span class="ruby-keyword kw">return</span> <span class="ruby-node">&quot;#{ self.title }&quot;</span>
113:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000068" class="method-detail">
        <a name="M000068"></a>

        <div class="method-heading">
          <a href="#M000068" class="method-signature">
          <span class="method-name">can_be_modified_by?</span><span class="method-args">( user )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Is the given user permitted to update this task? Restricted users cannot
modify tasks. Administrators always can. Managers only can if the task is
still active.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000068-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000068-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/task.rb, line 86</span>
86:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">can_be_modified_by?</span>( <span class="ruby-identifier">user</span> )
87:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> ( <span class="ruby-identifier">user</span>.<span class="ruby-identifier">restricted?</span> )
88:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>  <span class="ruby-keyword kw">if</span> ( <span class="ruby-identifier">user</span>.<span class="ruby-identifier">admin?</span>      )
89:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">active</span>
90:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000076" class="method-detail">
        <a name="M000076"></a>

        <div class="method-heading">
          <a href="#M000076" class="method-signature">
          <span class="method-name">committed_worked</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Number of committed hours worked on this task.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000076-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000076-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/task.rb, line 205</span>
205:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">committed_worked</span>
206:     <span class="ruby-identifier">sum</span> = <span class="ruby-value">0</span><span class="ruby-value">.0</span>
207: 
208:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">work_packets</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">work_packet</span> <span class="ruby-operator">|</span>
209:       <span class="ruby-identifier">sum</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">work_packet</span>.<span class="ruby-identifier">worked_hours</span> <span class="ruby-keyword kw">if</span> ( <span class="ruby-identifier">work_packet</span>.<span class="ruby-identifier">timesheet_row</span>.<span class="ruby-identifier">timesheet</span>.<span class="ruby-identifier">committed</span> )
210:     <span class="ruby-keyword kw">end</span>
211: 
212:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">sum</span>
213:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000067" class="method-detail">
        <a name="M000067"></a>

        <div class="method-heading">
          <a href="#M000067" class="method-signature">
          <span class="method-name">is_permitted_for?</span><span class="method-args">( user )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Is the given user permitted to do anything with this task?
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000067-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000067-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/task.rb, line 78</span>
78:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">is_permitted_for?</span>( <span class="ruby-identifier">user</span> )
79:     <span class="ruby-keyword kw">return</span> ( <span class="ruby-identifier">user</span>.<span class="ruby-identifier">privileged?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">tasks</span>.<span class="ruby-identifier">include?</span>( <span class="ruby-keyword kw">self</span> ) )
80:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000077" class="method-detail">
        <a name="M000077"></a>

        <div class="method-heading">
          <a href="#M000077" class="method-signature">
          <span class="method-name">not_committed_worked</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Number of not committed hours worked on this task.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000077-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000077-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/task.rb, line 217</span>
217:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">not_committed_worked</span>
218:     <span class="ruby-identifier">sum</span> = <span class="ruby-value">0</span><span class="ruby-value">.0</span>
219: 
220:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">work_packets</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">work_packet</span> <span class="ruby-operator">|</span>
221:       <span class="ruby-identifier">sum</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">work_packet</span>.<span class="ruby-identifier">worked_hours</span> <span class="ruby-keyword kw">unless</span> ( <span class="ruby-identifier">work_packet</span>.<span class="ruby-identifier">timesheet_row</span>.<span class="ruby-identifier">timesheet</span>.<span class="ruby-identifier">committed</span> )
222:     <span class="ruby-keyword kw">end</span>
223: 
224:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">sum</span>
225:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000072" class="method-detail">
        <a name="M000072"></a>

        <div class="method-heading">
          <a href="#M000072" class="method-signature">
          <span class="method-name">split_user_types</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Return an array with two elements - the first is the restricted associated
users, the second the unrestricted associated users. Arrays will be empty
if there are no associated users. Does this the slow way, asking each user
if it is restricted, rather than making assumptions about how to quickly
find restricted types.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000072-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000072-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/task.rb, line 128</span>
128:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">split_user_types</span>
129:     <span class="ruby-identifier">restricted</span>   = []
130:     <span class="ruby-identifier">unrestricted</span> = []
131: 
132:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">users</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">user</span> <span class="ruby-operator">|</span>
133:       <span class="ruby-keyword kw">if</span> ( <span class="ruby-identifier">user</span>.<span class="ruby-identifier">restricted?</span> )
134:         <span class="ruby-identifier">restricted</span>.<span class="ruby-identifier">push</span>( <span class="ruby-identifier">user</span> )
135:       <span class="ruby-keyword kw">else</span>
136:         <span class="ruby-identifier">unrestricted</span>.<span class="ruby-identifier">push</span>( <span class="ruby-identifier">user</span> )
137:       <span class="ruby-keyword kw">end</span>
138:     <span class="ruby-keyword kw">end</span>
139: 
140:     <span class="ruby-keyword kw">return</span> [ <span class="ruby-identifier">restricted</span>, <span class="ruby-identifier">unrestricted</span> ]
141:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000078" class="method-detail">
        <a name="M000078"></a>

        <div class="method-heading">
          <a href="#M000078" class="method-signature">
          <span class="method-name">sum_hours_over_range</span><span class="method-args">( date_range, user = nil )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Number of hours worked on the task between the given start and end Dates as
a Range. Optionally pass a <a href="User.html">User</a> object; work
packets will only be counted if they&#8216;re in a timesheet belonging to
that user.
</p>
<p>
Returns an object with fields &#8216;committed&#8217; and
&#8216;not_committed&#8217;, giving sums for those types of hours.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000078-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000078-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/task.rb, line 235</span>
235:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sum_hours_over_range</span>( <span class="ruby-identifier">date_range</span>, <span class="ruby-identifier">user</span> = <span class="ruby-keyword kw">nil</span> )
236:     <span class="ruby-identifier">committed_sum</span>     = <span class="ruby-value">0</span><span class="ruby-value">.0</span>
237:     <span class="ruby-identifier">not_committed_sum</span> = <span class="ruby-value">0</span><span class="ruby-value">.0</span>
238:     <span class="ruby-identifier">work_packets</span>      = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">work_packets</span>.<span class="ruby-identifier">find</span>( <span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:date</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">date_range</span> } )
239: 
240:     <span class="ruby-identifier">work_packets</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">work_packet</span> <span class="ruby-operator">|</span>
241:       <span class="ruby-identifier">timesheet</span> = <span class="ruby-identifier">work_packet</span>.<span class="ruby-identifier">timesheet_row</span>.<span class="ruby-identifier">timesheet</span>
242: 
243:       <span class="ruby-keyword kw">if</span> ( <span class="ruby-identifier">user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">timesheet</span>.<span class="ruby-identifier">user</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">user</span> )
244:         <span class="ruby-keyword kw">if</span> ( <span class="ruby-identifier">timesheet</span>.<span class="ruby-identifier">committed</span> )
245:           <span class="ruby-identifier">committed_sum</span>     <span class="ruby-operator">+=</span> <span class="ruby-identifier">work_packet</span>.<span class="ruby-identifier">worked_hours</span>
246:         <span class="ruby-keyword kw">else</span>
247:           <span class="ruby-identifier">not_committed_sum</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">work_packet</span>.<span class="ruby-identifier">worked_hours</span>
248:         <span class="ruby-keyword kw">end</span>
249:       <span class="ruby-keyword kw">end</span>
250:     <span class="ruby-keyword kw">end</span>
251: 
252:     <span class="ruby-keyword kw">return</span> { <span class="ruby-identifier">:committed</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">committed_sum</span>, <span class="ruby-identifier">:not_committed</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">not_committed_sum</span> }
253:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000075" class="method-detail">
        <a name="M000075"></a>

        <div class="method-heading">
          <a href="#M000075" class="method-signature">
          <span class="method-name">total_worked</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Number of hours worked on this task, committed or otherwise
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000075-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000075-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/task.rb, line 199</span>
199:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">total_worked</span>
200:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">work_packets</span>.<span class="ruby-identifier">sum</span>( <span class="ruby-identifier">:worked_hours</span> ) <span class="ruby-operator">||</span> <span class="ruby-value">0</span><span class="ruby-value">.0</span>
201:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000074" class="method-detail">
        <a name="M000074"></a>

        <div class="method-heading">
          <a href="#M000074" class="method-signature">
          <span class="method-name">update_with_side_effects!</span><span class="method-args">( attrs )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Update an object with the given attributes. This is done by a special model
method because changes of the &#8216;active&#8217; flag have side effects
for other associated objects. THE CALLER *<b>MUST</b>* USE A TRANSACTION
around a call to this method. There is no need to call here unless the
&#8216;active&#8217; flag state is changing.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000074-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000074-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/task.rb, line 168</span>
168:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_with_side_effects!</span>( <span class="ruby-identifier">attrs</span> )
169:     <span class="ruby-identifier">active</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">active</span>
170:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">update_attributes!</span>( <span class="ruby-identifier">attrs</span> )
171: 
172:     <span class="ruby-comment cmt"># If the active flag has changed and it *was* 'true', then the task</span>
173:     <span class="ruby-comment cmt"># has just been made inactive.</span>
174: 
175:     <span class="ruby-keyword kw">if</span> ( <span class="ruby-identifier">attrs</span>[ <span class="ruby-identifier">:active</span> ] <span class="ruby-operator">!=</span> <span class="ruby-identifier">active</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">active</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span> )
176: 
177:       <span class="ruby-comment cmt"># When tasks are made inactive, remove them from each of</span>
178:       <span class="ruby-comment cmt"># the Task lists in User and ControlPanel objects. There</span>
179:       <span class="ruby-comment cmt"># are checks for this elsewhere, but they're only to try</span>
180:       <span class="ruby-comment cmt"># and catch cases where this code has gone wrong.</span>
181:       <span class="ruby-comment cmt">#</span>
182:       <span class="ruby-comment cmt"># Since only restricted users actually make use of their</span>
183:       <span class="ruby-comment cmt"># tasks lists, save time by only changing that user type.</span>
184: 
185:       <span class="ruby-constant">User</span>.<span class="ruby-identifier">restricted</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">user</span> <span class="ruby-operator">|</span>
186:         <span class="ruby-identifier">user</span>.<span class="ruby-identifier">remove_inactive_tasks</span>()
187:         <span class="ruby-identifier">user</span>.<span class="ruby-identifier">save!</span>
188:       <span class="ruby-keyword kw">end</span>
189: 
190:       <span class="ruby-constant">ControlPanel</span>.<span class="ruby-identifier">find</span>( <span class="ruby-identifier">:all</span> ).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">cp</span> <span class="ruby-operator">|</span>
191:         <span class="ruby-identifier">cp</span>.<span class="ruby-identifier">remove_inactive_tasks</span>()
192:         <span class="ruby-identifier">cp</span>.<span class="ruby-identifier">save!</span>
193:       <span class="ruby-keyword kw">end</span>
194:     <span class="ruby-keyword kw">end</span>
195:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>